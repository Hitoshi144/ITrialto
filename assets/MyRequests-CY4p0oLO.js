import{Q as le}from"./QBadge-l-h_4b-W.js";import{Q as G}from"./QCardSection-Ct4B8z0C.js";import{Q as ie}from"./QBtn-nCgHYuWN.js";import{Q as oe}from"./QCard-Dri9TERK.js";import{Q as ne}from"./QDialog-C0WFBzRC.js";import{Q as C}from"./QSeparator-DCXVSXi9.js";import{h as K,Q as q}from"./vm-qSUGPvtL.js";import{D as re,r as m,k as W,H as j,X as ce,Y as de,L as ue,Z as pe,m as ee,K as ve,G as X,I as Y,P as fe,d as me,u as _e,z as h,b as o,e,f as i,w as y,T as Z,o as n,v as B,t as d,p as S,F as E,g as L,i as xe,a as ye,l as V}from"./index-Mo4dBhOw.js";import{s as he,n as M,o as U,q as F,g as ge}from"./focusout-BuI3YoVi.js";import{b as be,a as ke}from"./render-DXJ7UJne.js";import{b as J,c as O}from"./interpritation.service-_3ecFNJG.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-mFa0dIct.js";import"./use-timeout-HZbuKFz0.js";import"./focus-manager-zjdVGI5d.js";const{passive:T}=pe,D=re({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:he,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(u,{slots:P,emit:H}){const f=m(!1),v=m(!0),_=m(null),k=m(null);let w=u.initialIndex,a,c;const I=W(()=>"q-infinite-scroll__loading"+(f.value===!0?"":" invisible"));function g(){if(u.disable===!0||f.value===!0||v.value===!1)return;const r=M(a),x=U(a),R=K(a);u.reverse===!1?Math.round(x+R+u.offset)>=Math.round(r)&&b():Math.round(x)<=u.offset&&b()}function b(){if(u.disable===!0||f.value===!0||v.value===!1)return;w++,f.value=!0;const r=M(a);H("load",w,x=>{v.value===!0&&(f.value=!1,Y(()=>{if(u.reverse===!0){const R=M(a),se=U(a),ae=R-r;F(a,se+ae)}x===!0?Q():_.value&&_.value.closest("body")&&c()}))})}function z(){w=0}function N(){v.value===!1&&(v.value=!0,a.addEventListener("scroll",c,T)),g()}function Q(){v.value===!0&&(v.value=!1,f.value=!1,a.removeEventListener("scroll",c,T),c?.cancel?.())}function $(){if(a&&v.value===!0&&a.removeEventListener("scroll",c,T),a=ge(_.value,u.scrollTarget),v.value===!0){if(a.addEventListener("scroll",c,T),u.reverse===!0){const r=M(a),x=K(a);F(a,r-x)}g()}}function l(r){w=r}function s(r){r=parseInt(r,10);const x=c;c=r<=0?g:fe(g,isNaN(r)===!0?100:r),a&&v.value===!0&&(x!==void 0&&a.removeEventListener("scroll",x,T),a.addEventListener("scroll",c,T))}function t(r){if(p.value===!0){if(k.value===null){r!==!0&&Y(()=>{t(!0)});return}const x=`${f.value===!0?"un":""}pauseAnimations`;Array.from(k.value.getElementsByTagName("svg")).forEach(R=>{R[x]()})}}const p=W(()=>u.disable!==!0&&v.value===!0);j([f,p],()=>{t()}),j(()=>u.disable,r=>{r===!0?Q():N()}),j(()=>u.reverse,()=>{f.value===!1&&v.value===!0&&g()}),j(()=>u.scrollTarget,$),j(()=>u.debounce,s);let A=!1;ce(()=>{A!==!1&&a&&F(a,A)}),de(()=>{A=a?U(a):!1}),ue(()=>{v.value===!0&&a.removeEventListener("scroll",c,T)}),ee(()=>{s(u.debounce),$(),f.value===!1&&t()});const te=ve();return Object.assign(te.proxy,{poll:()=>{c?.()},trigger:b,stop:Q,reset:z,resume:N,setIndex:l,updateScrollTarget:$}),()=>{const r=be(P.default,[]);return p.value===!0&&r[u.reverse===!1?"push":"unshift"](X("div",{ref:k,class:I.value},ke(P.loading))),X("div",{class:"q-infinite-scroll",ref:_},r)}}}),Ce={class:"container"},Te={style:{display:"flex","flex-direction":"column","align-items":"center"}},Ie={class:"requests-window beautiful-bg-2"},Se={key:0},Pe={class:"intersection"},Qe={class:"request-line"},$e={style:{display:"flex",gap:"5px"}},Re={class:"index text"},je={class:"title text"},Be={class:"description text"},Ee={class:"status text"},Le=["onClick"],Ne={key:1,class:"btn-width-inner"},qe={key:1},Ve={class:"intersection"},Me={class:"request-line"},Oe={style:{display:"flex",gap:"5px"}},De={class:"index text"},He={class:"title text"},ze={class:"description text"},Ae={class:"status text"},Ue=["onClick"],Fe={key:1,class:"btn-width-inner"},Ge={key:2},Ke={class:"intersection"},We={class:"request-line"},Xe={style:{display:"flex",gap:"5px"}},Ye={class:"index text"},Ze={class:"title text"},Je={class:"description text"},et={class:"customer text"},tt={class:"status text"},st=["onClick"],at={key:1,class:"btn-width-inner"},lt={key:3},it={class:"intersection"},ot={class:"request-line"},nt={style:{display:"flex",gap:"5px"}},rt={class:"index text"},ct={class:"title text",style:{"min-width":"150px"}},dt={class:"description text"},ut={class:"status text"},pt=["onClick"],vt={key:1,class:"btn-width-inner"},ft=me({__name:"MyRequests",setup(u){const P=ye(),H=_e().getUser,f=m([]),v=["create-team","to-team","create-project","to-project"],_=m("create-team"),k=m(!1),w=m([]),a=m([]),c=m([]),I=m([]),g=m([]),b=m([]),z=async l=>{await P.push({name:"create-requests",hash:`#request-${l}`})},N=async l=>{await P.push({name:"my-projects",hash:`#request-${l}`,query:{tab:"pending"}})},Q=async l=>{try{await h.delete(`team-request/${l}`),V.success("Заявка на вступление в команду удалена"),a.value=a.value.filter(s=>s.id!==l)}catch(s){const t=s.response?.data?.message||s.message||"Произошла ошибка";V.error(t)}},$=async l=>{try{await h.delete(`project-request/${l}`),V.success("Заявка на назначение проекта удалена"),b.value=b.value.filter(s=>s.id!==l)}catch(s){const t=s.response?.data?.message||s.message||"Произошла ошибка";V.error(t)}};return ee(async()=>{w.value=(await h.get("create-team-request/my/all")).data,a.value=(await h.get(`team-request/${H?.id}/all`)).data,f.value=(await h.get("teams")).data,await Promise.all(a.value.map(async l=>{c.value.push((await h.get(`teams/${l.teamId}`)).data)})),I.value=(await h.get("project/my")).data.filter(l=>l.status==="pending"||l.status==="published"||l.status==="rejected"),await Promise.all(I.value.map(async l=>{g.value.some(s=>s.id===l.rialtoId)||g.value.push((await h.get(`rialto/${l.rialtoId}`)).data)})),await Promise.all(f.value.map(async l=>{b.value.push(...(await h.get(`project-request/my-team/${l.id}`)).data),c.value.some(s=>s.id===l.id)||c.value.push((await h.get(`teams/${l.id}`)).data)}))}),(l,s)=>(n(),o("div",Ce,[e("div",{class:"current-requests-category beautiful-bg",onClick:s[0]||(s[0]=t=>k.value=!0)},[i(le,{color:"primary","text-color":"secondary",class:"requests-announcement"},{default:y(()=>s[2]||(s[2]=[B(" Заявки на ")])),_:1}),i(Z,{name:"fade",mode:"out-in"},{default:y(()=>[(n(),o("p",{key:_.value,class:"requests-title"},d(S(J)[_.value]),1))]),_:1})]),i(ne,{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=t=>k.value=t),"backdrop-filter":"blur(4px)","transition-show":"fade","transition-hide":"fade"},{default:y(()=>[i(oe,{flat:"",bordered:"",class:"change-category-card"},{default:y(()=>[e("div",Te,[i(G,null,{default:y(()=>s[3]||(s[3]=[e("p",{class:"select-category-title"},"Выберите биржу",-1)])),_:1}),(n(),o(E,null,L(v,t=>i(G,{key:t},{default:y(()=>[i(ie,{outline:"",color:"primary",label:S(J)[t],class:"select-category-btn",onClick:p=>{_.value=t,k.value=!1}},null,8,["label","onClick"])]),_:2},1024)),64))])]),_:1})]),_:1},8,["modelValue"]),e("div",Ie,[i(Z,{name:"fade",mode:"out-in"},{default:y(()=>[_.value==="create-team"?(n(),o("div",Se,[s[5]||(s[5]=e("div",{class:"request-line invisible-scroll"},[e("div",{style:{display:"flex",gap:"5px"}},[e("p",{class:"index text"}),e("p",{class:"title text"},"Название")]),e("p",{class:"description text"},"Описание команды"),e("p",{class:"status text"},"статус заявки"),e("p",{class:"btn-width"})],-1)),i(C,{color:"primary"}),e("div",Pe,[i(D,null,{default:y(()=>[(n(!0),o(E,null,L(w.value,t=>(n(),o("div",{key:t.id},[e("div",Qe,[e("div",$e,[e("p",Re,d(w.value.indexOf(t)+1),1),e("p",je,d(t.title),1)]),e("p",Be,d(t.description),1),e("p",Ee,d(S(O)[t.status]),1),t.status==="pending"?(n(),o("button",{key:0,class:"btn btn-2 hover-opacity",onClick:p=>z(t.id)},[e("span",null,[s[4]||(s[4]=B("к заявке ")),i(q,{name:"north_east",size:"16px"})])],8,Le)):(n(),o("div",Ne))]),i(C,{color:"primary"})]))),128))]),_:1})])])):_.value==="to-team"?(n(),o("div",qe,[s[7]||(s[7]=e("div",{class:"request-line invisible-scroll"},[e("div",{style:{display:"flex",gap:"5px"}},[e("p",{class:"index text"}),e("p",{class:"title text"},"Название")]),e("p",{class:"description text"},"Описание команды"),e("p",{class:"status text"},"статус заявки"),e("p",{class:"btn-width"})],-1)),i(C,{color:"primary"}),e("div",Ve,[i(D,null,{default:y(()=>[(n(!0),o(E,null,L(a.value,t=>(n(),o("div",{key:t.id},[e("div",Me,[e("div",Oe,[e("p",De,d(a.value.indexOf(t)+1),1),e("p",He,d(c.value.find(p=>p.id===t.teamId)?.title),1)]),e("p",ze,d(c.value.find(p=>p.id===t.teamId)?.description),1),e("p",Ae,d(S(O)[t.status]),1),t.status==="pending"?(n(),o("button",{key:0,class:"btn btn-2 hover-opacity",onClick:p=>Q(t.id)},[e("span",null,[s[6]||(s[6]=B("удалить ")),i(q,{name:"cancel",size:"16px"})])],8,Ue)):(n(),o("div",Fe))]),i(C,{color:"primary"})]))),128))]),_:1})])])):_.value==="create-project"?(n(),o("div",Ge,[s[9]||(s[9]=e("div",{class:"request-line invisible-scroll"},[e("div",{style:{display:"flex",gap:"5px"}},[e("p",{class:"index text"}),e("p",{class:"title text"},"Название")]),e("p",{class:"description text"},"Биржа"),e("p",{class:"customer text"},"Заказчик"),e("p",{class:"status text"},"статус заявки"),e("p",{class:"btn-width"})],-1)),i(C,{color:"primary"}),e("div",Ke,[i(D,null,{default:y(()=>[(n(!0),o(E,null,L(I.value,t=>(n(),o("div",{key:t.id},[e("div",We,[e("div",Xe,[e("p",Ye,d(I.value.indexOf(t)+1),1),e("p",Ze,d(t.title),1)]),e("p",Je,d(g.value.find(p=>p.id===t.rialtoId)?.title),1),e("p",et,d(t.customer),1),e("p",tt,d(S(O)[t.status]),1),t.status==="pending"?(n(),o("button",{key:0,class:"btn btn-2 hover-opacity",onClick:p=>N(t.id)},[e("span",null,[s[8]||(s[8]=B("К заявке ")),i(q,{name:"north_east",size:"16px"})])],8,st)):(n(),o("div",at))]),i(C,{color:"primary"})]))),128))]),_:1})])])):_.value==="to-project"?(n(),o("div",lt,[s[11]||(s[11]=e("div",{class:"request-line invisible-scroll"},[e("div",{style:{display:"flex",gap:"5px"}},[e("p",{class:"index text"}),e("p",{class:"title text",style:{"min-width":"150px"}},"Команда")]),e("p",{class:"description text"},"Проект"),e("p",{class:"status text"},"статус заявки"),e("p",{class:"btn-width"})],-1)),i(C,{color:"primary"}),e("div",it,[i(D,null,{default:y(()=>[(n(!0),o(E,null,L(b.value,t=>(n(),o("div",{key:t.id},[e("div",ot,[e("div",nt,[e("p",rt,d(b.value.indexOf(t)+1),1),e("p",ct,d(c.value.find(p=>p.id===t.teamId)?.title),1)]),e("p",dt,d(t.project.title),1),e("p",ut,d(S(O)[t.status]),1),t.status==="pending"?(n(),o("button",{key:0,class:"btn btn-2 hover-opacity",onClick:p=>$(t.id)},[e("span",null,[s[10]||(s[10]=B("Удалить ")),i(q,{name:"cancel",size:"16px"})])],8,pt)):(n(),o("div",vt))]),i(C,{color:"primary"})]))),128))]),_:1})])])):xe("",!0)]),_:1})])]))}}),$t=we(ft,[["__scopeId","data-v-8bc2fede"]]);export{$t as default};
