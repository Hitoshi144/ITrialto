import{Q as A}from"./QBadge-l-h_4b-W.js";import{Q as X,a as U}from"./QTabs-BC3pXEG1.js";import{Q as y}from"./QBtn-nCgHYuWN.js";import{Q as M}from"./QSeparator-DCXVSXi9.js";import{Q as Z,a as B}from"./QTabPanels-CC8M1Kjj.js";import{Q as q}from"./QInput-CNi2zBEZ.js";import{d as ee,r as c,m as te,z as v,H as L,Q as ae,b,e as o,f as s,w as p,o as d,v as r,t as l,i as w,F as E,g as N,h as _,T as R,l as m,q as oe,a as le}from"./index-Mo4dBhOw.js";import{A as se}from"./auth.service-BOxIUbgp.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./render-DXJ7UJne.js";import"./vm-qSUGPvtL.js";import"./uid-Bzmka5Fh.js";import"./use-timeout-HZbuKFz0.js";import"./rtl-DFPa-2ov.js";import"./use-dark-mFa0dIct.js";import"./selection-DaqN-jlY.js";import"./focus-manager-zjdVGI5d.js";const ie={class:"container"},ne={class:"q-pa-md"},de={class:"q-gutter-y-md",style:{"max-width":"400px"}},ue={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},ce={class:"main-text"},pe={class:"main-text"},me={class:"main-text"},ve={style:{"text-decoration":"underline"}},ge={class:"main-text"},fe={style:{"margin-top":"30px","margin-bottom":"20px",display:"flex","flex-direction":"row","justify-content":"space-around"}},ye={key:0,class:"main-text"},xe={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},be={class:"main-text"},he={class:"main-text"},we={class:"main-text"},_e={class:"main-text"},je={class:"main-text"},ke={class:"main-text"},Ce={class:"main-text"},Re={class:"main-text"},$e={class:"main-text"},Qe={class:"main-text"},Ve={key:0},Pe={style:{"margin-top":"30px","margin-bottom":"20px",display:"flex","flex-direction":"row","justify-content":"space-around"}},Te=ee({__name:"RequestsModerationPage",setup(Se){const $=oe(),D=le(),x=c("teams"),k=c({}),u=c([]),i=c([]),j=c([]),Q=c({}),C=c({}),g=c(!1),h=c(""),f=c(null),V=c([]),I=async a=>{try{const e=await se.getAvatar(a);if(e&&e.size>0){const t=URL.createObjectURL(e);k.value={...k.value,[a]:t}}}catch(e){console.error(`Ошибка загрузки аватара пользователя ${a}:`,e)}},F=a=>{f.value=a,g.value=!0,h.value=""},P=()=>{f.value=null,g.value=!1,h.value=""},O=async a=>{try{if(h.value.length===0)return m.error("Введите причину");await v.patch(`project/${a}/revision`,{comment:h.value}),P(),i.value=i.value.filter(e=>e.id!==a),m.success("Отправлено на доработку")}catch(e){const t=e.response?.data?.message||e.message||"Произошла ошибка";m.error(t)}},z=async(a,e)=>{try{const t=(await v.get(`user/${e}`)).data;C.value[a]=t}catch(t){console.log(t.message)}},H=(a,e)=>{Q.value[a]=e.replace("{","").replace("}","").replaceAll(",",", ")},Y=async a=>{try{const e=await v.get(`user/${a}`);j.value[a]=e.data,await I(e.data.id)}catch(e){console.log("Ошибка загрузки данных лидеров:",e)}},T=a=>{const e=new Date(a),t=n=>n.toString().padStart(2,"0");return`${t(e.getDate())}.${t(e.getMonth()+1)}.${e.getFullYear()}`},G=async a=>{try{await v.patch(`create-team-request/${a}/approve`),m.success("Заявка одобрена"),u.value=u.value.filter(e=>e.id!=a)}catch(e){m.error(e.message)}},J=async a=>{try{await v.patch(`create-team-request/${a}/reject`),m.success("Заявка отклонена"),u.value=u.value.filter(e=>e.id!=a)}catch(e){m.error(e.message)}},K=async a=>{try{await v.patch(`project/${a}/publish`),m.success("Проект опубликован"),i.value=i.value.filter(e=>e.id!=a)}catch(e){const t=e.response?.data?.message||e.message||"Произошла ошибка";m.error(t)}},W=async a=>{try{await v.patch(`project/${a}/reject`),m.success("Заявка отклонена"),i.value=i.value.filter(e=>e.id!=a)}catch(e){const t=e.response?.data?.message||e.message||"Произошла ошибка";m.error(t)}},S={pending:"На рассмотрении",approved:"Одобрена",rejected:"Отклонена"};return te(async()=>{u.value=(await v.get("create-team-request/pending")).data,u.value.forEach(a=>{Y(a.creatorId).catch(e=>console.error("Error loading leaders:",e))}),i.value=(await v.get("project/pending")).data,V.value=(await v.get("rialto")).data,i.value.forEach(a=>{H(a.id,a.stack),z(a.id,a.userId).catch(e=>console.log(e.message))})}),L(x,async a=>{await D.push({query:{...$.query,tab:a}})}),L(()=>$.query.tab,a=>{a&&a!==x.value&&(x.value=a.toString())}),ae(()=>{Object.entries(k.value).forEach(([a])=>{a&&typeof a=="string"&&URL.revokeObjectURL(a)})}),(a,e)=>(d(),b("div",ie,[o("div",ne,[o("div",de,[s(X,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),"narrow-indicator":"",dense:"",align:"justify",class:"text-primary beautiful-bg"},{default:p(()=>[s(U,{ripple:!1,name:"teams",icon:"groups",label:"Команды",style:{"margin-right":"50px","padding-left":"50px","padding-right":"50px","border-radius":"20px 20px 0 0",border:"1px solid rgba(65, 120, 156, 0.5)","border-bottom":"0"}},{default:p(()=>[s(A,{color:"primary",floating:""},{default:p(()=>[r(l(u.value.length),1)]),_:1})]),_:1}),s(U,{ripple:!1,name:"projects",icon:"emoji_objects",label:"Проекты",style:{"padding-left":"50px","padding-right":"50px","border-radius":"20px 20px 0 0",border:"1px solid rgba(65, 120, 156, 0.5)","border-bottom":"0"}},{default:p(()=>[s(A,{color:"primary",floating:""},{default:p(()=>[r(l(i.value.length),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Z,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=t=>x.value=t),animated:"",swipeable:"","transition-prev":"slide-right","transition-next":"slide-left",style:{width:"85vw","justify-self":"center",margin:"0","border-radius":"10px"},class:"beautiful-bg-2"},{default:p(()=>[s(B,{name:"teams"},{default:p(()=>[(d(!0),b(E,null,N(u.value,t=>(d(),b("div",{key:t.id},[o("div",ue,[o("p",ce,[e[3]||(e[3]=o("strong",null,"Название:",-1)),r(" "+l(t.title),1)]),s(y,{outline:"",color:"primary",disable:"",label:S[t.status||"withoutStatus"],style:{"margin-top":"20px","border-radius":"10px",height:"20px","min-width":"175px"}},null,8,["label"])]),o("p",pe,[e[4]||(e[4]=o("strong",null,"Описание:",-1)),r(" "+l(t.description),1)]),o("p",me,[e[5]||(e[5]=o("strong",null,"Тим-лидер:",-1)),r(" "+l(j.value[t.creatorId]?.firstname)+" "+l(j.value[t.creatorId]?.lastname)+" (",1),o("span",ve,l(j.value[t.creatorId]?.mail),1),e[6]||(e[6]=r(")"))]),o("p",ge,[e[7]||(e[7]=o("strong",null,"Дата подачи:",-1)),r(" "+l(T(t.createdAt)),1)]),o("div",fe,[s(y,{filled:"",color:"primary",label:"Принять",style:{"border-radius":"10px",width:"150px"},onClick:n=>G(t.id)},null,8,["onClick"]),s(y,{outline:"",color:"primary",label:"Отклонить",style:{"border-radius":"10px",width:"150px"},onClick:n=>J(t.id)},null,8,["onClick"])]),t.id!=u.value[u.value.length-1]?.id?(d(),_(M,{key:0,color:"primary"})):w("",!0)]))),128)),u.value.length===0?(d(),b("p",ye,"Заявок на создание команды нету :(")):w("",!0)]),_:1}),s(B,{name:"projects"},{default:p(()=>[(d(!0),b(E,null,N(i.value,t=>(d(),b("div",{key:t.id},[o("div",xe,[o("p",be,[e[8]||(e[8]=o("strong",null,"Название:",-1)),r(" "+l(t.title),1)]),s(y,{outline:"",color:"primary",disable:"",label:S[t.status||"withoutStatus"],style:{"margin-top":"20px","border-radius":"10px",height:"20px","min-width":"175px"}},null,8,["label"])]),o("p",he,[e[9]||(e[9]=o("strong",null,"Заказчик:",-1)),r(" "+l(t.customer),1)]),o("p",we,[e[10]||(e[10]=o("strong",null,"Инициатор:",-1)),r(" "+l(C.value[t.id]?.firstname)+" "+l(C.value[t.id]?.lastname),1)]),o("p",_e,[e[11]||(e[11]=o("strong",null,"Биржа:",-1)),r(" "+l(V.value.find(n=>n.id===t.rialtoId)?.title),1)]),o("p",je,[e[12]||(e[12]=o("strong",null,"Макс. кол-во человек в команде:",-1)),r(" "+l(t.maxPeopleNumber),1)]),o("p",ke,[e[13]||(e[13]=o("strong",null,"Проблема:",-1)),r(" "+l(t.problem),1)]),o("p",Ce,[e[14]||(e[14]=o("strong",null,"Решение:",-1)),r(" "+l(t.solution),1)]),o("p",Re,[e[15]||(e[15]=o("strong",null,"Ожидаемый результат:",-1)),r(" "+l(t.expectedResult),1)]),o("p",$e,[e[16]||(e[16]=o("strong",null,"Стек:",-1)),r(" "+l(Q.value[t.id]),1)]),o("p",Qe,[e[17]||(e[17]=o("strong",null,"Дата подачи:",-1)),r(" "+l(T(t.createdAt)),1)]),s(R,{name:"slide",mode:"out-in"},{default:p(()=>[g.value&&t.id===f.value?.id?(d(),b("div",Ve,[s(q,{outlined:"",autofocus:"",autogrow:"",modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=n=>h.value=n),label:"Введите причину",rules:[n=>!!n||"*поле обязательно для заполнения"]},null,8,["modelValue","rules"])])):w("",!0)]),_:2},1024),o("div",Pe,[s(R,{name:"fade",mode:"out-in"},{default:p(()=>[!g.value||t.id!==f.value?.id?(d(),_(y,{key:0,filled:"",color:"primary",label:"Опубликовать",style:{"border-radius":"10px",width:"150px"},onClick:n=>K(t.id)},null,8,["onClick"])):w("",!0)]),_:2},1024),s(y,{outline:!(g.value&&t.id===f.value?.id),filled:!!(g.value&&t.id===f.value?.id),color:"primary",label:"На доработку",style:{"border-radius":"10px",width:"150px"},onClick:n=>g.value&&t.id===f.value?.id?O(t.id):F(t)},null,8,["outline","filled","onClick"]),s(R,{name:"fade",mode:"out-in"},{default:p(()=>[g.value&&t.id===f.value?.id?(d(),_(y,{key:0,outline:"",label:"отмена",color:"primary",style:{"border-radius":"10px",width:"150px"},onClick:P})):!g.value||t.id!==f.value?.id?(d(),_(y,{key:1,outline:"",color:"primary",label:"Отклонить",style:{"border-radius":"10px",width:"150px"},onClick:n=>W(t.id)},null,8,["onClick"])):w("",!0)]),_:2},1024)]),t.id!=i.value[i.value.length-1]?.id?(d(),_(M,{key:0,color:"primary"})):w("",!0)]))),128))]),_:1})]),_:1},8,["modelValue"])])])]))}}),We=re(Te,[["__scopeId","data-v-a6849801"]]);export{We as default};
