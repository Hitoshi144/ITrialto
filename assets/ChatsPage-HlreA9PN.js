import{u as dt,a as ct,Q as L}from"./QBtn-nCgHYuWN.js";import{Q as Z}from"./QInput-CNi2zBEZ.js";import{g as vt,Q as ie}from"./vm-qSUGPvtL.js";import{v as mt,c as Re,u as ft,d as pt,e as gt,r as Ie,s as ht,p as Oe,f as yt,Q as xt,b as bt,a as kt}from"./QItemSection-BXYQ52H8.js";import{Q as ge}from"./QList-DmTvSCh-.js";import{D as qe,k as T,G as M,K as _t,r as v,H as R,L as Pe,M as ze,N as Ge,T as he,O as Ct,d as wt,u as St,j as Mt,P as Me,z as B,m as Tt,Q as Vt,b as i,e as l,f as d,F as ee,g as te,i as m,t as r,p as b,w as k,h as D,R as je,S as $t,U as Ht,l as H,o as n,V as De,v as K,x as Pt,J as Fe,n as Ke}from"./index-Mo4dBhOw.js";import{u as Te,a as qt,s as Bt,b as Ut,c as Et,d as At,e as Nt,g as Qt}from"./focusout-BuI3YoVi.js";import{u as Lt,a as Rt}from"./use-timeout-HZbuKFz0.js";import{c as We}from"./selection-DaqN-jlY.js";import{a as It}from"./render-DXJ7UJne.js";import{Q as Je}from"./QCheckbox-cCcz-w8e.js";import{Q as Ve}from"./QDialog-C0WFBzRC.js";import{Q as Ot}from"./QBadge-l-h_4b-W.js";import{C as zt}from"./ClosePopup-BbmzLGBu.js";import{a as ae}from"./avatar_alt-Cq5VdRAy.js";import{f as $e,p as Xe}from"./interpritation.service-_3ecFNJG.js";import{b as de}from"./browser-DEm_zawB.js";import{A as Gt}from"./auth.service-BOxIUbgp.js";import{_ as jt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./uid-Bzmka5Fh.js";import"./use-dark-mFa0dIct.js";import"./focus-manager-zjdVGI5d.js";const He=qe({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(o,{slots:u}){const p=T(()=>o.sent===!0?"sent":"received"),P=T(()=>`q-message-text-content q-message-text-content--${p.value}`+(o.textColor!==void 0?` text-${o.textColor}`:"")),V=T(()=>`q-message-text q-message-text--${p.value}`+(o.bgColor!==void 0?` text-${o.bgColor}`:"")),g=T(()=>"q-message-container row items-end no-wrap"+(o.sent===!0?" reverse":"")),F=T(()=>o.size!==void 0?`col-${o.size}`:""),h=T(()=>({msg:o.textHtml===!0?"innerHTML":"textContent",stamp:o.stampHtml===!0?"innerHTML":"textContent",name:o.nameHtml===!0?"innerHTML":"textContent",label:o.labelHtml===!0?"innerHTML":"textContent"}));function I(y){return u.stamp!==void 0?[y,M("div",{class:"q-message-stamp"},u.stamp())]:o.stamp?[y,M("div",{class:"q-message-stamp",[h.value.stamp]:o.stamp})]:[y]}function _(y,C){const U=C===!0?y.length>1?w=>w:w=>M("div",[w]):w=>M("div",{[h.value.msg]:w});return y.map((w,W)=>M("div",{key:W,class:V.value},[M("div",{class:P.value},I(U(w)))]))}return()=>{const y=[];u.avatar!==void 0?y.push(u.avatar()):o.avatar!==void 0&&y.push(M("img",{class:`q-message-avatar q-message-avatar--${p.value}`,src:o.avatar,"aria-hidden":"true"}));const C=[];u.name!==void 0?C.push(M("div",{class:`q-message-name q-message-name--${p.value}`},u.name())):o.name!==void 0&&C.push(M("div",{class:`q-message-name q-message-name--${p.value}`,[h.value.name]:o.name})),u.default!==void 0?C.push(_(vt(u.default()),!0)):o.text!==void 0&&C.push(_(o.text)),y.push(M("div",{class:F.value},C));const U=[];return u.label!==void 0?U.push(M("div",{class:"q-message-label"},u.label())):o.label!==void 0&&U.push(M("div",{class:"q-message-label",[h.value.label]:o.label})),U.push(M("div",{class:g.value},y)),M("div",{class:`q-message q-message-${p.value}`},U)}}}),Dt='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',Ft=qe({name:"QSpinnerDots",props:dt,setup(o){const{cSize:u,classes:p}=ct(o);return()=>M("svg",{class:p.value,fill:"currentColor",width:u.value,height:u.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:Dt})}}),Kt=qe({name:"QTooltip",inheritAttrs:!1,props:{...ft,...Ut,...Te,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...Te.transitionShow,default:"jump-down"},transitionHide:{...Te.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Re},self:{type:String,default:"top middle",validator:Re},offset:{type:Array,default:()=>[14,14],validator:mt},scrollTarget:Bt,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...qt],setup(o,{slots:u,emit:p,attrs:P}){let V,g;const F=_t(),{proxy:{$q:h}}=F,I=v(null),_=v(!1),y=T(()=>Oe(o.anchor,h.lang.rtl)),C=T(()=>Oe(o.self,h.lang.rtl)),U=T(()=>o.persistent!==!0),{registerTick:w,removeTick:W}=Lt(),{registerTimeout:N}=Rt(),{transitionProps:G,transitionStyle:J}=Et(o),{localScrollTarget:E,changeScrollEvent:q,unconfigureScrollTarget:$}=pt(o,me),{anchorEl:S,canShow:O,anchorEvents:Q}=gt({showing:_,configureAnchorEl:X}),{show:se,hide:j}=At({showing:_,canShow:O,handleShow:ye,handleHide:ne,hideOnRouteChange:U,processOnMount:!0});Object.assign(Q,{delayShow:oe,delayHide:xe});const{showPortal:ce,hidePortal:le,renderPortal:ve}=Nt(F,I,ke,"tooltip");if(h.platform.is.mobile===!0){const x={anchorEl:S,innerRef:I,onClickOutside(A){return j(A),A.target.classList.contains("q-dialog__backdrop")&&Ct(A),!0}},re=T(()=>o.modelValue===null&&o.persistent!==!0&&_.value===!0);R(re,A=>{(A===!0?yt:Ie)(x)}),Pe(()=>{Ie(x)})}function ye(x){ce(),w(()=>{g=new MutationObserver(()=>f()),g.observe(I.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),f(),me()}),V===void 0&&(V=R(()=>h.screen.width+"|"+h.screen.height+"|"+o.self+"|"+o.anchor+"|"+h.lang.rtl,f)),N(()=>{ce(!0),p("show",x)},o.transitionDuration)}function ne(x){W(),le(),s(),N(()=>{le(!0),p("hide",x)},o.transitionDuration)}function s(){g!==void 0&&(g.disconnect(),g=void 0),V!==void 0&&(V(),V=void 0),$(),ze(Q,"tooltipTemp")}function f(){ht({targetEl:I.value,offset:o.offset,anchorEl:S.value,anchorOrigin:y.value,selfOrigin:C.value,maxHeight:o.maxHeight,maxWidth:o.maxWidth})}function oe(x){if(h.platform.is.mobile===!0){We(),document.body.classList.add("non-selectable");const re=S.value,A=["touchmove","touchcancel","touchend","click"].map(fe=>[re,fe,"delayHide","passiveCapture"]);Ge(Q,"tooltipTemp",A)}N(()=>{se(x)},o.delay)}function xe(x){h.platform.is.mobile===!0&&(ze(Q,"tooltipTemp"),We(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),N(()=>{j(x)},o.hideDelay)}function X(){if(o.noParentEvent===!0||S.value===null)return;const x=h.platform.is.mobile===!0?[[S.value,"touchstart","delayShow","passive"]]:[[S.value,"mouseenter","delayShow","passive"],[S.value,"mouseleave","delayHide","passive"]];Ge(Q,"anchor",x)}function me(){if(S.value!==null||o.scrollTarget!==void 0){E.value=Qt(S.value,o.scrollTarget);const x=o.noParentEvent===!0?f:j;q(E.value,x)}}function be(){return _.value===!0?M("div",{...P,ref:I,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",P.class],style:[P.style,J.value],role:"tooltip"},It(u.default)):null}function ke(){return M(he,G.value,be)}return Pe(s),Object.assign(F.proxy,{updatePosition:f}),ve}}),Wt={class:"container"},Jt={class:"window"},Xt={class:"chats-panel beautiful-bg-2 no-select"},Yt={class:"chats-creating"},Zt={key:0},ea=["onClick"],ta=["src"],aa=["src"],sa={class:"chat-info"},la={class:"chat-header"},na={key:0,class:"chat-title"},ia={key:1,class:"chat-title"},oa={key:2,class:"chat-date"},ra={style:{display:"flex","flex-direction":"row","justify-content":"space-between","align-items":"center"}},ua={key:0,class:"chat-last-message"},da={key:1,class:"chat-last-message"},ca={key:2,class:"chat-last-message"},va={key:4,class:"unread-in-chat"},ma={key:1,class:"search-results-container"},fa={class:"search-results-scroll"},pa=["onClick"],ga={key:0,class:"chat-card"},ha=["src"],ya={class:"chat-info"},xa={class:"chat-header"},ba={class:"chat-title"},ka={key:2},_a={class:"current-chat beautiful-bg"},Ca={key:0,class:"chat-container"},wa={class:"messages-header"},Sa={style:{display:"flex","flex-direction":"row","align-items":"center"}},Ma=["src"],Ta=["src"],Va={key:1,class:"chat-header-title"},$a={key:2,class:"participants-count"},Ha={class:"q-message-stamp",style:{display:"flex","flex-direction":"row","justify-content":"flex-end","align-items":"center"}},Pa={key:0,style:{"margin-bottom":"5px",color:"#202226"}},qa={class:"input-message-panel"},Ba={key:1,style:{width:"100%",height:"100%",display:"flex","flex-direction":"column"}},Ua={class:"messages-header",style:{"justify-content":"flex-start"}},Ea=["src"],Aa={class:"chat-header-title"},Na={class:"input-message-panel"},Qa={key:2},La={key:0,style:{width:"90%",display:"flex","flex-direction":"column","align-items":"center"}},Ra={key:0,class:"adding-participants-list search-results-scroll"},Ia={key:0,class:"participants-intersection"},Oa=["src"],za={style:{display:"flex","flex-direction":"column"}},Ga={class:"selected-users"},ja={key:0},Da={key:0},Fa={style:{display:"flex","flex-direction":"row","align-items":"center"}},Ka=["src"],Wa={style:{display:"flex","flex-direction":"column","align-items":"center"}},Ja={key:0,style:{display:"flex","flex-direction":"row"}},Xa={class:"chat-title"},Ya={key:1,style:{display:"flex","flex-direction":"column"}},Za={style:{display:"flex","flex-direction":"row","justify-content":"space-evenly","margin-top":"20px","margin-bottom":"10px"}},es={class:"participants-count",style:{color:"#41789C"}},ts={class:"participants-list"},as={class:"participant-block"},ss=["src"],ls={class:"participant-info"},ns={key:0,style:{width:"90%",display:"flex","flex-direction":"column","align-items":"center"}},is={key:0,class:"adding-participants-list search-results-scroll"},os={key:0,class:"participants-intersection"},rs=["src"],us={style:{display:"flex","flex-direction":"column"}},ds={class:"participant-block"},cs=["src"],vs={class:"participant-info"},ms={style:{display:"flex",gap:"100px"}},fs=wt({__name:"ChatsPage",setup(o){const u=St().getUser,p=Mt(),P=v({}),V=T(()=>p.chats),g=T(()=>p.messages),F=T(()=>p.chatting),h=v(!1),I=v(!0),_=v(""),y=v(!1),C=v([]),U=v(!1),w=v(void 0),W=v(!1),N=v(!1),G=v(""),J=v(!1),E=v(),q=v(!1),$=v(""),S=v([]),O=v([]),Q=v(""),se=v("Сообщение"),j=v(null),ce=()=>{j.value&&j.value.click()},le=a=>ve.value[a]?ve.value[a]:$t,ve=T(()=>p.chatAvatars),ye=async a=>{const t=a.target.files?.[0];if(t)try{const c=new FormData;c.append("avatar",t),s.value&&await B.post(`chat/avatar/${s.value.id}`,c,{headers:{"Content-Type":"multipart/form-data"}}),H.success("Аватар чата обновлён!")}catch(c){console.error("Ошибка загрузки аватара:",c),H.error(c.response?.data?.message||"Ошибка загрузки")}finally{j.value&&(j.value.value="")}},ne=v({}),s=v(),f=v(""),oe=v({}),xe=new Set,X=a=>{const e=g.value[a];return!e||e.length===0?"":e[e.length-1]?.content||""},me=a=>{const e=g.value[a];return!e||e.length===0?!1:e[e.length-1]?.isRead},be=a=>{const e=g.value[a];return!e||e.length===0?"":e[e.length-1]?.createdAt||""},ke=a=>{const e=g.value[a];return!e||e.length===0?"":e[e.length-1]?.sender.firstname||""},x=a=>{const e=g.value[a];return!e||e.length===0?"":e[e.length-1]?.sender.id},re=a=>{if(!s.value)return!0;const e=g.value[s.value.id];if(!e)return!0;const t=e.findIndex(Y=>Y.id===a.id);return t<=0?!0:e[t-1].sender.id!==a.sender.id},A=a=>{if(!s.value)return!0;const e=g.value[s.value.id];if(!e)return!0;const t=e.findIndex(Y=>Y.id===a.id);return t<=0||t===e.length-1?!0:e[t+1].sender.id!==a.sender.id},fe=a=>a!==u.id,_e=async a=>{if(!P.value[a])try{const e=await Gt.getAvatar(a);P.value[a]=e&&e.size>0?URL.createObjectURL(e):ae}catch(e){P.value[a]=ae,console.error(e.message)}},z=a=>P.value[a]?P.value[a]:(_e(a),ae),Ye=async()=>{try{const a=(await B.patch("chat/name",{chatId:s.value?.id,name:G.value})).data;p.setNewChatName(a),N.value=!1,G.value="",H.success("Название чата изменено")}catch(a){const e=a.response?.data?.message||a.message||"Произошла ошибка";H.error(e)}},Ze=a=>{s.value=a,de.nextTick(()=>{De(),we()})},et=a=>{let e=!0;return V.value.forEach(t=>{t.isGroup||t.participants.forEach(c=>{c.id===a&&(e=!1)})}),e},ue=Me(()=>{const a=document.querySelector(".messages-container");a&&(I.value=a.scrollHeight-a.scrollTop-a.clientHeight<100,we())},100),tt=(a,e)=>{let t=null;a instanceof HTMLElement?t=a:a&&typeof a=="object"&&"$el"in a&&(t=a.$el),t&&(oe.value[e]=t)},Ce=async(a,e)=>{try{const t=u.id,c=await B.post("chat/message",{chatId:a,senderId:t,content:e});p.addMessage(c.data),f.value="",de.nextTick(()=>Ht())}catch(t){const c=t.response?.data?.message||t.message||"Произошла ошибка";H.error(c)}},Be=a=>{const e=g.value[a];if(!e||e.length===0)return 0;let t=0;return e.forEach(c=>{c.isRead||(t+=1)}),t},at=async()=>{try{const a=[];O.value.forEach(t=>a.push(t.id));const e=(await B.post("chat/group",{name:Q.value,userIds:a})).data;p.chats.unshift(e),h.value=!1,H.success("Групповой чат создан")}catch(a){const e=a.response?.data?.message||a.message||"Произошла ошибка";H.error(e)}},we=Me(()=>{if(!s.value)return;const a=document.querySelector(".messages-container");if(!a)return;const e=a.getBoundingClientRect(),t=s.value.id;Object.entries(oe.value).forEach(([c,Y])=>{const Le=Number(c),Se=g.value[t]?.find(pe=>pe.id===Le);if(Se&&Se.sender.id!==u.id&&!Se.isRead){const pe=Y.getBoundingClientRect();pe.top>=e.top-50&&pe.bottom<=e.bottom+50&&st(Le)}})},200),Ue=T(()=>a=>{if(a.isGroup)return ae;if(!a.participants||!u)return ae;const e=a.participants.filter(t=>t.id!==u.id);return e.length?z(e[0].id):ae}),st=async a=>{try{const e=s.value?.id;if(!e)return;const t=g.value[e]?.find(c=>c.id===a);if(!t||t.sender.id===u.id||t.isRead)return;p.markMessageAsRead(e,a),await B.patch(`chat/${a}`),delete oe.value[a]}catch(e){console.error("Ошибка пометки сообщения:",e)}finally{xe.delete(a)}},lt=a=>{let e=!0;if(s.value)return s.value.participants.forEach(t=>{t.id===a&&(e=!1)}),e},nt=()=>{const a=document.querySelector(".messages-container");a&&a.scrollTo({top:a.scrollHeight,behavior:"smooth"})},it=T(()=>{if(I.value||!s.value)return!1;const a=g.value[s.value.id];return a?a.some(e=>!e.isRead&&e.sender.id!==u?.id):!1}),Ee=Me(async a=>{if(!a.trim()){C.value=[];return}try{y.value=!0,_.value!==""?C.value=(await B.get(`user/search/${_.value}`)).data:$.value!==""&&(C.value=(await B.get(`user/search/${$.value}`)).data),C.value.forEach(e=>{P.value[e.id]||z(e.id)})}catch(e){console.error("Search error:",e)}finally{y.value=!1}},500),ot=async()=>{try{if(!s.value||!E.value)return;const a=s.value?.id,e=E.value.id;let t=[];t=[...t,e],await B.patch("chat/remove",{chatId:a,userIds:t}),J.value=!1,E.value=void 0,H.success("Пользователь удален из чата")}catch(a){const e=a.response?.data?.message||a.message||"Произошла ошибка";H.error(e)}},rt=async()=>{try{if(!s.value||!S.value)return;const a=s.value.id,e=S.value;await B.patch("chat/add",{chatId:a,userIds:e}),q.value=!1,$.value="",S.value=[],H.success("Пользователи добавлены в чат")}catch(a){const e=a.response?.data?.message||a.message||"Произошла ошибка";H.error(e)}},Ae=()=>s.value?.participants.filter(a=>a.id!==u.id)[0],Ne=a=>a.participants.filter(e=>e.id!==u.id)[0],Qe=async a=>{try{const e=(await B.post("chat/private",{user2Id:a})).data;V.value.unshift(e),s.value=e,U.value=!1,_.value="",s.value&&Ce(s.value?.id,f.value)}catch(e){const t=e.response?.data?.message||e.message||"Произошла ошибка";H.error(t)}},ut=async()=>{try{if(!s.value)return;await B.delete(`chat/${s.value.id}`),p.removeChat(s.value),s.value=void 0,H.success("Чат удален")}catch(a){const e=a.response?.data?.message||a.message||"Произошла ошибка";H.error(e)}};return R(_,a=>{Ee(a)}),R($,a=>{Ee(a)}),R(()=>V.value,a=>{a.forEach(e=>{e.participants.filter(t=>t.id!==u.id).forEach(t=>{_e(t.id)})})}),R(()=>g.value[s.value?.id||0],()=>{de.nextTick(we)},{deep:!0}),R(()=>f.value,async()=>{f.value.trim()!==""&&s.value?await B.post(`chat/chatting/${s.value?.id}`):f.value.trim()===""&&s.value&&await B.post(`chat/stopchatting/${s.value?.id}`),f.value.trim()!==""?se.value="":f.value.trim()===""&&(se.value="Сообщение")}),R(()=>[...V.value],a=>{s.value&&!a.some(e=>e.id===s.value?.id)&&(s.value=void 0)},{deep:!0}),R(()=>V.value.find(a=>a.id===s.value?.id),a=>{a&&s.value?.isGroup&&s.value&&a.name!==s.value?.name&&a.name&&(s.value.name=a.name),a&&s.value?.isGroup&&s.value&&a.participants.length!==s.value.participants.length&&(s.value.participants=a.participants)}),R(()=>s.value?.id?F.value[s.value.id]:void 0,(a,e)=>{!a||a===e||de.nextTick(()=>{const t=document.querySelector(".messages-container");if(!t)return;const c=t.scrollHeight-t.scrollTop<=t.clientHeight+100,Y=t.scrollHeight-t.scrollTop<t.clientHeight+300;(c||Y)&&requestAnimationFrame(()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})})},{deep:!0}),R(()=>s.value,()=>{f.value=""}),Tt(()=>{const a=document.querySelector(".messages-container");a&&(a.addEventListener("scroll",ue),ue()),_e(u.id)}),Vt(()=>{const a=document.querySelector(".messages-container");a&&a.removeEventListener("scroll",ue)}),Pe(()=>{Object.values(P.value).forEach(a=>{a&&a!==ae&&URL.revokeObjectURL(a)})}),(a,e)=>(n(),i("div",Wt,[l("div",Jt,[l("div",Xt,[l("div",Yt,[d(L,{class:"add-group-btn",color:"primary",outline:"",icon:"add",label:"групповой чат",onClick:e[0]||(e[0]=t=>{h.value=!0,_.value=""})}),d(Z,{class:"user-search",dense:"",rounded:"",outlined:"",label:"Поиск",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),color:"primary",loading:y.value},null,8,["modelValue","loading"])]),V.value.length>0&&_.value.trim()===""?(n(),i("div",Zt,[(n(!0),i(ee,null,te(V.value,t=>(n(),i("div",{class:"chat-card",key:t.id,style:{color:"black"},onClick:c=>{Ze(t),b(de.nextTick)(()=>b(De)())}},[t.isGroup?t.isGroup?(n(),i("img",{key:1,class:"user-avatar",src:le(t.id)},null,8,aa)):m("",!0):(n(),i("img",{key:0,class:"user-avatar",src:Ue.value(t)},null,8,ta)),l("div",sa,[l("div",la,[t.isGroup?(n(),i("p",ia,r(t.name),1)):(n(),i("p",na,r(Ne(t)?.firstname)+" "+r(Ne(t)?.lastname),1)),X(t.id)?(n(),i("p",oa,r(b($e)(be(t.id))),1)):m("",!0)]),l("div",ra,[!t.isGroup&&X(t.id)?(n(),i("p",ua,r(X(t.id)),1)):t.isGroup&&t.messages&&x(t.id)!==b(u).id?(n(),i("p",da,[l("strong",null,r(ke(t.id))+":",1),K(" "+r(X(t.id)),1)])):t.messages&&x(t.id)===b(u).id?(n(),i("p",ca,[e[31]||(e[31]=l("strong",null,"Вы:",-1)),K(" "+r(X(t.id)),1)])):m("",!0),t.messages&&x(t.id)===b(u).id?(n(),D(ie,{key:3,name:me(t.id)?"done_all":"check",style:{"margin-right":"20px"},size:"18px",color:"primary"},null,8,["name"])):t.messages&&x(t.id)!==b(u).id&&Be(t.id)!==0?(n(),i("p",va,r(Be(t.id)),1)):m("",!0)])])],8,ea))),128))])):_.value.trim()!==""?(n(),i("div",ma,[l("div",fa,[(n(!0),i(ee,null,te(C.value,t=>(n(),i("div",{key:t.id,onClick:c=>{s.value=void 0,U.value=!0,w.value=t}},[et(t.id)?(n(),i("div",ga,[l("img",{class:"user-avatar",src:z(t.id)},null,8,ha),l("div",ya,[l("div",xa,[l("p",ba,r(t.firstname)+" "+r(t.lastname),1)])])])):m("",!0)],8,pa))),128))])])):(n(),i("p",ka," чатов нет "))]),l("div",_a,[s.value?(n(),i("div",Ca,[l("div",wa,[l("div",Sa,[s.value.isGroup?s.value.isGroup?(n(),i("img",{key:1,class:"user-avatar",src:le(s.value.id)},null,8,Ta)):m("",!0):(n(),i("img",{key:0,class:"user-avatar",src:Ue.value(s.value)},null,8,Ma)),l("div",null,[s.value.isGroup?(n(),i("p",{key:0,class:"chat-header-title onHover",onClick:e[2]||(e[2]=t=>W.value=!0)},r(s.value.name),1)):s.value.isGroup?m("",!0):(n(),i("p",Va,r(Ae()?.firstname)+" "+r(Ae()?.lastname),1)),s.value.isGroup?(n(),i("p",$a,r(s.value.participants.length)+" "+r(b(Xe)(s.value.participants.length)),1)):m("",!0)])]),d(L,{flat:"",icon:"more_horiz",color:"secondary",style:{"margin-right":"20px"}},{default:k(()=>[d(xt,{class:"bg-secondary"},{default:k(()=>[d(ge,{style:{width:"200px"}},{default:k(()=>[Pt((n(),D(kt,{clickable:"",style:{display:"flex","align-items":"center"},class:"red-on-hover",onClick:e[3]||(e[3]=t=>ut())},{default:k(()=>[d(bt,{style:{color:"#eb6449"}},{default:k(()=>e[32]||(e[32]=[K("Удалить чат")])),_:1}),d(ie,{name:"delete",color:"negative",size:"20px"})]),_:1})),[[zt]])]),_:1})]),_:1})]),_:1})]),l("div",{class:"messages-container",onScroll:e[4]||(e[4]=(...t)=>b(ue)&&b(ue)(...t))},[(n(!0),i(ee,null,te(g.value[s.value.id],t=>(n(),i("div",{key:t.id,ref_for:!0,ref:c=>t.sender.id!==b(u).id&&tt(c,t.id)},[t.sender.id===b(u).id?(n(),D(He,{key:0,style:Fe([{"margin-right":"10px","margin-top":"10px"},A(t)?null:{"margin-right":"65px"}]),sent:"",avatar:A(t)?z(b(u).id):void 0,"bg-color":"primary","text-color":"secondary"},{default:k(()=>[l("div",null,[K(r(t.content)+" ",1),l("div",Ha,[l("div",null,r(b($e)(t.createdAt)),1),d(he,{name:"fade",mode:"out-in"},{default:k(()=>[d(ie,{class:"q-message-stamp",style:{display:"flex","justify-self":"flex-end",margin:"0","margin-left":"5px"},name:t.isRead?"done_all":"check",size:"18px"},null,8,["name"])]),_:2},1024)])])]),_:2},1032,["avatar","style"])):t.sender.id!==b(u).id?(n(),D(He,{key:1,style:Fe([{"margin-left":"10px","margin-top":"10px"},A(t)?null:{"margin-left":"65px"}]),stamp:b($e)(t.createdAt),avatar:A(t)?z(t.sender.id):void 0,"bg-color":"secondary"},{default:k(()=>[l("div",null,[s.value.isGroup&&re(t)?(n(),i("div",Pa,[l("strong",null,r(t.sender.firstname),1)])):m("",!0),l("div",null,r(t.content),1)])]),_:2},1032,["stamp","avatar","style"])):m("",!0)]))),128)),F.value[s.value.id]?(n(),D(He,{key:0,"bg-color":"secondary",style:{"margin-left":"65px","margin-top":"10px"}},{default:k(()=>[d(Ft,{size:"2rem"})]),_:1})):m("",!0),it.value?(n(),i("div",{key:1,class:"new-messages-alert",onClick:nt},[d(ie,{name:"keyboard_arrow_down",size:"24px"}),d(Kt,null,{default:k(()=>e[33]||(e[33]=[K("Новые сообщения")])),_:1})])):m("",!0)],32),l("div",qa,[d(Z,{class:"input-message",borderless:"",modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),dense:"",label:se.value,onKeyup:e[6]||(e[6]=je(t=>f.value.trim()!==""&&Ce(s.value.id,f.value),["enter"]))},null,8,["modelValue","label"]),d(L,{class:"send-btn",disable:f.value.trim()==="",flat:"",round:"",icon:"send",onClick:e[7]||(e[7]=t=>Ce(s.value.id,f.value))},null,8,["disable"])])])):U.value&&s.value===void 0&&w.value&&_.value!==""?(n(),i("div",Ba,[l("div",Ua,[l("img",{class:"user-avatar",src:z(w.value.id)},null,8,Ea),l("div",null,[l("p",Aa,r(w.value?.firstname)+" "+r(w.value?.lastname),1)])]),e[34]||(e[34]=l("div",{class:"messages-container"},null,-1)),l("div",Na,[d(Z,{class:"input-message",borderless:"",modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=t=>f.value=t),dense:"",label:se.value,onKeyup:e[9]||(e[9]=je(t=>f.value.trim()!==""&&Qe(w.value.id),["enter"]))},null,8,["modelValue","label"]),d(L,{class:"send-btn",disable:f.value.trim()==="",flat:"",round:"",icon:"send",onClick:e[10]||(e[10]=t=>Qe(w.value.id))},null,8,["disable"])])])):(n(),i("div",Qa))])]),d(Ve,{modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=t=>h.value=t),onBeforeHide:e[16]||(e[16]=t=>{Q.value="",q.value=!1,O.value=[],$.value=""}),onBeforeShow:e[17]||(e[17]=t=>q.value=!0)},{default:k(()=>[d(ge,{class:"chat-details"},{default:k(()=>[e[37]||(e[37]=l("p",{class:"participants-title"},"Введите название чата",-1)),d(Z,{outlined:"",label:"название",modelValue:Q.value,"onUpdate:modelValue":e[11]||(e[11]=t=>Q.value=t),style:{width:"80%","margin-top":"10px"},rules:[t=>!!t||"Введите название чата"]},null,8,["modelValue","rules"]),e[38]||(e[38]=l("p",{class:"participants-title"},"Выберите участников чата",-1)),q.value?(n(),i("div",La,[d(Z,{class:"user-search",dense:"",rounded:"",outlined:"",label:"Поиск",modelValue:$.value,"onUpdate:modelValue":e[12]||(e[12]=t=>$.value=t),color:"primary",loading:y.value},null,8,["modelValue","loading"]),$.value.trim()!==""?(n(),i("div",Ra,[(n(!0),i(ee,null,te(C.value,t=>(n(),i("div",{key:t.id},[fe(t.id)?(n(),i("div",Ia,[l("img",{class:"user-avatar",src:z(t.id)},null,8,Oa),l("div",za,[l("p",null,r(t.firstname)+" "+r(t.lastname),1),l("p",null,r(t.mail),1)]),d(Je,{"keep-color":"",modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=c=>O.value=c),val:t,color:"secondary"},null,8,["modelValue","val"])])):m("",!0)]))),128))])):m("",!0),l("div",Ga,[(n(!0),i(ee,null,te(O.value,t=>(n(),i("p",{key:t.id},[K(r(t.firstname)+" "+r(t.lastname),1),O.value.indexOf(t)!==S.value.length?(n(),i("span",ja,", ")):m("",!0)]))),128)),l("p",null,[e[35]||(e[35]=K("Вы")),O.value.length!==0?(n(),i("span",Da,", ")):m("",!0)]),e[36]||(e[36]=l("p",null,[l("strong",null,"Состав чата: ")],-1))]),d(L,{filled:"",color:"primary",label:"создать",style:{width:"200px","border-radius":"10px","margin-top":"20px"},disable:O.value.length===0||Q.value==="",onClick:e[14]||(e[14]=t=>at())},null,8,["disable"])])):m("",!0)]),_:1})]),_:1},8,["modelValue"]),d(Ve,{modelValue:W.value,"onUpdate:modelValue":e[26]||(e[26]=t=>W.value=t),onBeforeHide:e[27]||(e[27]=t=>{$.value="",q.value=!1,N.value=!1,G.value=""})},{default:k(()=>[d(ge,{class:"chat-details search-results-scroll"},{default:k(()=>[l("div",Fa,[l("input",{type:"file",ref_key:"fileInput",ref:j,onChange:ye,accept:"image/*",style:{display:"none"}},null,544),l("img",{class:"user-avatar avatar-on-hover",src:le(s.value.id),style:{height:"100px","margin-right":"20px",cursor:"pointer"},onClick:ce},null,8,Ka),l("div",Wa,[d(he,{name:"fade",mode:"out-in"},{default:k(()=>[N.value?N.value?(n(),i("div",Ya,[d(Z,{dense:"",modelValue:G.value,"onUpdate:modelValue":e[19]||(e[19]=t=>G.value=t),style:{width:"300px"},color:"primary","input-style":"color: #41789C; margin: 0; font-size: 16px;"},null,8,["modelValue"]),l("div",Za,[d(L,{filled:"",label:"сохранить",color:"primary",style:{"border-radius":"10px"},onClick:e[20]||(e[20]=t=>Ye())}),d(L,{outline:"",label:"отмена",color:"primary",style:{"border-radius":"10px"},onClick:e[21]||(e[21]=t=>{N.value=!1,G.value=""})})])])):m("",!0):(n(),i("div",Ja,[l("p",Xa,r(s.value?.name),1),s.value?(n(),D(ie,{key:0,name:"edit",color:"primary",size:"18px",class:"edit-name-btn",onClick:e[18]||(e[18]=t=>{N.value=!0,G.value=s.value.name})})):m("",!0)]))]),_:1}),l("p",es,r(s.value?.participants.length)+" "+r(b(Xe)(s.value.participants.length)),1)])]),e[40]||(e[40]=l("p",{class:"participants-title"},"Участники",-1)),l("div",ts,[(n(!0),i(ee,null,te(s.value?.participants,t=>(n(),i("div",{class:Ke(["participant-big-block",{hovered:ne.value[t.id]}]),key:t.id},[l("div",as,[l("img",{src:z(t.id),class:"user-avatar"},null,8,ss),l("div",ls,[l("p",null,r(t.firstname)+" "+r(t.lastname),1),l("p",null,r(t.mail),1),t.id===s.value?.createdBy.id?(n(),D(Ot,{key:0},{default:k(()=>e[39]||(e[39]=[K("Админ")])),_:1})):m("",!0)])]),t.id!==s.value?.createdBy.id&&s.value?.createdBy.id===b(u)?.id?(n(),D(ie,{key:0,onMouseover:c=>ne.value[t.id]=!0,onMouseleave:c=>ne.value[t.id]=!1,class:Ke(["onHover-remove",{hovered:ne.value[t.id]}]),name:"remove",size:"18px",style:{"padding-left":"4px","padding-right":"4px"},onClick:c=>{E.value=t,J.value=!0}},null,8,["onMouseover","onMouseleave","class","onClick"])):m("",!0)],2))),128))]),s.value?.createdBy.id===b(u).id?(n(),D(L,{key:0,color:"primary",filled:!q.value,outline:!!q.value,label:q.value?"отмена":"добавить участника",style:{width:"200px","border-radius":"10px","margin-top":"50px"},onClick:e[22]||(e[22]=t=>{q.value=!q.value,$.value=""})},null,8,["filled","outline","label"])):m("",!0),d(he,{name:"slide-fade",mode:"out-in"},{default:k(()=>[q.value?(n(),i("div",ns,[d(Z,{class:"user-search",dense:"",rounded:"",outlined:"",label:"Поиск",modelValue:$.value,"onUpdate:modelValue":e[23]||(e[23]=t=>$.value=t),color:"primary",loading:y.value},null,8,["modelValue","loading"]),$.value.trim()!==""?(n(),i("div",is,[(n(!0),i(ee,null,te(C.value,t=>(n(),i("div",{key:t.id},[lt(t.id)?(n(),i("div",os,[l("img",{class:"user-avatar",src:z(t.id)},null,8,rs),l("div",us,[l("p",null,r(t.firstname)+" "+r(t.lastname),1),l("p",null,r(t.mail),1)]),d(Je,{"keep-color":"",modelValue:S.value,"onUpdate:modelValue":e[24]||(e[24]=c=>S.value=c),val:t.id,color:"secondary"},null,8,["modelValue","val"])])):m("",!0)]))),128))])):m("",!0),d(L,{filled:"",color:"primary",label:"добавить",style:{width:"200px","border-radius":"10px","margin-top":"20px"},disable:S.value.length===0,onClick:e[25]||(e[25]=t=>rt())},null,8,["disable"])])):m("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),d(Ve,{modelValue:J.value,"onUpdate:modelValue":e[30]||(e[30]=t=>J.value=t)},{default:k(()=>[d(ge,{class:"chat-details",style:{height:"300px","justify-content":"space-between"}},{default:k(()=>[l("div",ds,[l("img",{src:z(E.value.id),class:"user-avatar"},null,8,cs),l("div",vs,[l("p",null,r(E.value.firstname)+" "+r(E.value.lastname),1),l("p",null,r(E.value.mail),1)])]),e[41]||(e[41]=l("p",{class:"alert-message"},"Исключить данного участника из чата?",-1)),l("div",ms,[d(L,{outline:"",label:"да",color:"primary",style:{"border-radius":"10px",width:"100px"},onClick:e[28]||(e[28]=t=>ot())}),d(L,{filled:"",label:"нет",color:"primary",style:{"border-radius":"10px",width:"100px"},onClick:e[29]||(e[29]=t=>{J.value=!1,E.value=void 0})})])]),_:1})]),_:1},8,["modelValue"])]))}}),Qs=jt(fs,[["__scopeId","data-v-fec0e71c"]]);export{Qs as default};
