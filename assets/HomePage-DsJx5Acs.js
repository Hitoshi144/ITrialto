import{_ as Z,a as G,b as K,c as X,d as Y,e as ee,f as te,g as se}from"./quasar-logo-vertical-aqTeathg.js";import{Q as C}from"./QBadge-l-h_4b-W.js";import{Q as c}from"./vm-qSUGPvtL.js";import{Q as $}from"./QSeparator-DCXVSXi9.js";import{Q as P,a as y,b as g}from"./QItemSection-BXYQ52H8.js";import{Q as S}from"./QList-DmTvSCh-.js";import{Q as q}from"./QBtn-nCgHYuWN.js";import{C as b}from"./ClosePopup-BbmzLGBu.js";import{d as M,u as ae,j as oe,k as x,r as U,m as re,b as d,o as r,e as s,p as _,a as ie,i as p,f as o,q as ne,T as le,w as l,h as f,v as a,t as i,n as Q,F as N,g as de,x as j,y as pe,l as A,z as ce,A as ue}from"./index-Mo4dBhOw.js";import{A as me}from"./auth.service-BOxIUbgp.js";import{a as _e}from"./avatar_alt-Cq5VdRAy.js";import{s as fe}from"./interpritation.service-_3ecFNJG.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./render-DXJ7UJne.js";import"./use-dark-mFa0dIct.js";import"./selection-DaqN-jlY.js";import"./focusout-BuI3YoVi.js";import"./focus-manager-zjdVGI5d.js";import"./use-timeout-HZbuKFz0.js";const ge="/ITrialto/assets/logo-g9_Wq8Ea.png",ve="/ITrialto/assets/logout-D_Zad7WF.png",ke={class:"header"},be={class:"header_logo"},je={class:"tabs"},xe=["checked"],he=["checked"],we={key:0,class:"glider"},Te={class:"notif-profile"},Re={class:"notification-tale"},Ie={key:0,class:"notification-data"},ze={class:"notification-text"},Ce={key:1,class:"notification-data"},$e={class:"notification-text"},qe={key:2,class:"notification-data"},Qe={class:"notification-text"},Pe={key:3,class:"notification-data"},Se={class:"notification-text"},Ue={key:4,class:"notification-data"},Ae={class:"notification-text"},Me={key:5,class:"notification-data"},Ne={class:"notification-text"},Je={key:6,class:"notification-data"},Be={class:"notification-text"},Le={key:7,class:"notification-data"},Ee={class:"notification-text"},He={key:8,class:"notification-data"},Ve={class:"notification-text"},De={key:9,class:"notification-data"},Fe={class:"notification-text"},Oe={key:10,class:"notification-data"},We={class:"notification-text"},Ze={key:11,class:"notification-data"},Ge={class:"notification-text"},Ke={key:12,class:"notification-data"},Xe={class:"notification-text"},Ye={key:13,class:"notification-data"},et={class:"notification-text"},tt={key:14,class:"notification-data"},st={class:"notification-text"},at={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},ot={class:"notification-date"},rt=["onClick"],it={class:"profile_logo"},nt=["src"],lt=["src"],dt={class:"name_rule"},pt={class:"name"},ct=["src"],ut=M({__name:"HeaderControl",setup(J){const w=ae(),v=oe(),T=x(()=>v.chats),B=x(()=>v.messages),u=ie(),k=ne(),h=x(()=>v.notifications),L=U(!1),E=x(()=>k.name==="projects"||k.name==="teams-registry"||k.name==="team-detail"),R=U((n=>new URL(Object.assign({"../assets/1af82c8ed1916d70e58f662999ce7461.jpg":se,"../assets/avatar_alt.png":te,"../assets/i_so_tired.png":ee,"../assets/logo.png":Y,"../assets/logout.png":X,"../assets/photo_2024-05-16_09-57-47.jpg":K,"../assets/photo_2024-08-05_19-14-54.jpg":G,"../assets/quasar-logo-vertical.svg":Z})[`../assets/${n}`],import.meta.url).href)("avatar_alt.png")),m=x(()=>w.getUser),H={parther:"Партнер",student:"Студент",teacher:"Преподаватель",withoutRole:"Без роли"},V=n=>{switch(n){case"userJoinedToTeam":case"rejectedTeamJoin":case"teamMemberRemoved":case"createTeamRejected":case"notAssignedTeam":case"resignedTeam":return!1;default:return!0}},D=async n=>{try{await ce.patch(`notifications/${n}/read`),v.markNotificationAsRead(n)}catch(e){const t=e.response?.data?.message||e.message||"Произошла ошибка";A.error(t)}},F=()=>{setTimeout(()=>{h.value.filter(e=>!e.isRead).forEach(e=>{D(e.id).catch(t=>{console.error("Ошибка при пометке уведомления как прочитанного:",t)})})},3e3)},O=async()=>{w.logout(),pe("token"),await u.push({name:"auth"})},W=async n=>{try{switch(n.type){case"teamJoinRequest":case"assignedTeam":await u.push({name:"i-teamleader",hash:`#team-${n.teamId}`});break;case"createTeamApproved":await u.push({name:"i-teamleader",hash:`#team-${n.teamId}`});break;case"approvedTeamJoin":await u.push({name:"i-member",hash:`#team-${n.teamId}`});break;case"publishedProject":case"toProjectRequest":await u.push({name:"my-projects",query:{tab:"published"},hash:`#project-${n.projectId}`});break;case"rejectedProject":await u.push({name:"my-projects",query:{tab:"rejected"},hash:`#project-${n.projectId}`});break;case"revisionProject":await u.push({name:"my-projects",query:{tab:"revision"},hash:`#project-${n.projectId}`});break;case"completeProject":await u.push({name:"projects",params:{rialtoId:n.project.rialtoId,projectId:n.projectId}})}}catch(e){const t=e.response?.data?.message||e.message||"Произошла ошибка";A.error(t)}},I=()=>{let n=0;return T.value.forEach(e=>{const t=B.value[e.id];t&&t.forEach(z=>{!z.isRead&&m.value&&z.sender.id!==m.value.id&&(n+=1)})}),n};return re(async()=>{if(m.value?.id)try{const n=await me.getAvatar(m.value.id);n&&n.size>0&&(R.value=URL.createObjectURL(n))}catch(n){console.error("Ошибка загрузки аватара:",n)}}),(n,e)=>(r(),d("div",ke,[s("div",be,[s("img",{src:ge,alt:"Аватар",class:"logo avatar-image",onClick:e[0]||(e[0]=t=>_(u).push({name:"projects-exchange"}))}),e[5]||(e[5]=s("h1",{class:"logo-text no-select"},"ITrialto",-1))]),s("nav",null,[s("div",je,[s("input",{type:"radio",id:"radio-1",name:"tabs",checked:_(k).name==="projects"},null,8,xe),s("label",{class:"tab",for:"radio-1",onClick:e[1]||(e[1]=t=>_(u).push({name:"projects",params:{rialtoId:4}}))},"Биржа проектов"),s("input",{type:"radio",id:"radio-2",name:"tabs",checked:_(k).name==="teams-registry"||_(k).name==="team-detail"},null,8,he),m.value?.role==="teacher"||m.value?.role==="student"?(r(),d("label",{key:0,class:"tab",for:"radio-2",onClick:e[2]||(e[2]=t=>_(u).push({name:"teams-registry"}))},"Реестр команд")):p("",!0),o(le,{name:"glide",mode:"out-in"},{default:l(()=>[E.value?(r(),d("span",we)):p("",!0)]),_:1})])]),s("div",Te,[o(q,{flat:"",class:"bg-accent notifications-btn",color:"secondary",style:{"border-radius":"10px"},icon:"notifications",onClick:e[3]||(e[3]=t=>{L.value=!0,F()})},{default:l(()=>[h.value.filter(t=>!t.isRead).length>0?(r(),f(C,{key:0,color:"primary",class:Q(["notif-count",{"notification-pulse":_(v).hasNewNotification}]),floating:""},{default:l(()=>[a(i(h.value.filter(t=>!t.isRead).length),1)]),_:1},8,["class"])):p("",!0),o(P,{"transition-show":"jump-down","transition-hide":"jump-up","transition-duration":"300",fit:"",offset:[50,5]},{default:l(()=>[o(S,{class:"bg-secondary notifications-menu"},{default:l(()=>[(r(!0),d(N,null,de(h.value,t=>(r(),f(y,{key:t.id,class:Q({"notification-unread":!t.isRead,"notification-read":t.isRead})},{default:l(()=>[s("div",Re,[t.type==="teamJoinRequest"?(r(),d("div",Ie,[o(c,{name:"person_add",class:"notification-icon",size:"30px",color:"primary"}),s("p",ze,[e[6]||(e[6]=a("Пользователь ")),s("span",null,i(t.fromUser.firstname)+" "+i(t.fromUser.lastname),1),e[7]||(e[7]=a(" хочет вступить в команду ")),s("span",null,i(t.team.title),1)])])):p("",!0),t.type==="userJoinedToTeam"?(r(),d("div",Ce,[o(c,{name:"group_add",class:"notification-icon",size:"30px",color:"primary"}),s("p",$e,[s("span",null,i(t.fromUser.firstname)+" "+i(t.fromUser.lastname),1),e[8]||(e[8]=a(" присоеденился к команде ")),s("span",null,i(t.team.title)+".",1)])])):p("",!0),t.type==="approvedTeamJoin"?(r(),d("div",qe,[o(c,{name:"how_to_reg",class:"notification-icon",size:"30px",color:"primary"}),s("p",Qe,[e[9]||(e[9]=a("Заявка на вступление в команду ")),s("span",null,i(t.team.title),1),e[10]||(e[10]=a(" одобрена."))])])):p("",!0),t.type==="rejectedTeamJoin"?(r(),d("div",Pe,[o(c,{name:"sentiment_dissatisfied",class:"notification-icon",size:"30px",color:"primary"}),s("p",Se,[e[11]||(e[11]=a("Заявка на вступление в команду ")),s("span",null,i(t.team.title),1),e[12]||(e[12]=a(" отклонена"))])])):p("",!0),t.type==="teamMemberRemoved"?(r(),d("div",Ue,[o(c,{name:"person_remove",class:"notification-icon",size:"30px",color:"primary"}),s("p",Ae,[e[13]||(e[13]=a("Вас исключили из команды ")),s("span",null,i(t.team.title)+".",1)])])):p("",!0),t.type==="createTeamApproved"?(r(),d("div",Me,[o(c,{name:"diversity_3",class:"notification-icon",size:"30px",color:"primary"}),s("p",Ne,[e[14]||(e[14]=a("Создание команды ")),s("span",null,i(t.team.title),1),e[15]||(e[15]=a(" одобрено."))])])):p("",!0),t.type==="createTeamRejected"?(r(),d("div",Je,[o(c,{name:"group_remove",class:"notification-icon",size:"30px",color:"primary"}),s("p",Be,[e[16]||(e[16]=a("Создание команды ")),s("span",null,i(t.message),1),e[17]||(e[17]=a(" отклонено."))])])):p("",!0),t.type==="publishedProject"?(r(),d("div",Le,[o(c,{name:"publish",class:"notification-icon",size:"30px",color:"primary"}),s("p",Ee,[e[18]||(e[18]=a("Ваш проект ")),s("span",null,i(t.project.title),1),e[19]||(e[19]=a(" опубликован."))])])):p("",!0),t.type==="rejectedProject"?(r(),d("div",He,[o(c,{name:"unpublished",class:"notification-icon",size:"30px",color:"primary"}),s("p",Ve,[e[20]||(e[20]=a("Ваш проект ")),s("span",null,i(t.project.title),1),e[21]||(e[21]=a(" отклонен."))])])):p("",!0),t.type==="revisionProject"?(r(),d("div",De,[o(c,{name:"report",class:"notification-icon",size:"30px",color:"primary"}),s("p",Fe,[e[22]||(e[22]=a("Ваш проект ")),s("span",null,i(t.project.title),1),e[23]||(e[23]=a(" отправлен на доработку."))])])):p("",!0),t.type==="notAssignedTeam"?(r(),d("div",Oe,[o(c,{name:"cancel_schedule_send",class:"notification-icon",size:"30px",color:"primary"}),s("p",We,[e[24]||(e[24]=a("Заявка на проект ")),s("span",null,i(t.project.title),1),e[25]||(e[25]=a(" от команды ")),s("span",null,i(t.team.title),1),e[26]||(e[26]=a(" отклонена."))])])):p("",!0),t.type==="assignedTeam"?(r(),d("div",Ze,[o(c,{name:"verified",class:"notification-icon",size:"30px",color:"primary"}),s("p",Ge,[e[27]||(e[27]=a("Заявка на проект ")),s("span",null,i(t.project.title),1),e[28]||(e[28]=a(" от команды ")),s("span",null,i(t.team.title),1),e[29]||(e[29]=a(" одобрена."))])])):p("",!0),t.type==="toProjectRequest"?(r(),d("div",Ke,[o(c,{name:"hail",class:"notification-icon",size:"30px",color:"primary"}),s("p",Xe,[e[30]||(e[30]=a("Команда ")),s("span",null,i(t.team.title),1),e[31]||(e[31]=a(" отправила заявку на проект ")),s("span",null,i(t.project.title),1),e[32]||(e[32]=a("."))])])):p("",!0),t.type==="resignedTeam"?(r(),d("div",Ye,[o(c,{name:"group_off",class:"notification-icon",size:"30px",color:"primary"}),s("p",et,[e[33]||(e[33]=a("Команда ")),s("span",null,i(t.team.title),1),e[34]||(e[34]=a(" была снята с проекта ")),s("span",null,i(t.project.title),1),e[35]||(e[35]=a("."))])])):p("",!0),t.type==="completeProject"?(r(),d("div",tt,[o(c,{name:"task_alt",class:"notification-icon",size:"30px",color:"primary"}),s("p",st,[e[36]||(e[36]=a("Команда ")),s("span",null,i(t.team.title),1),e[37]||(e[37]=a(" завершила проект ")),s("span",null,i(t.project.title),1),e[38]||(e[38]=a("."))])])):p("",!0),s("div",at,[s("p",ot,i(_(fe)(t.timestamp.toString())),1),V(t.type)?(r(),d("p",{key:0,class:"goTo",onClick:z=>W(t)},"Перейти",8,rt)):p("",!0)]),o($,{color:"primary"})])]),_:2},1032,["class"]))),128))]),_:1})]),_:1})]),_:1}),o(q,{flat:"",class:"bg-accent notifications-btn",color:"secondary",style:{"border-radius":"10px"},icon:"chat",onClick:e[4]||(e[4]=t=>_(u).push({name:"chats"}))},{default:l(()=>[I()!==0?(r(),f(C,{key:0,color:"primary",class:Q(["notif-count",{"notification-pulse":I()!==0}]),floating:""},{default:l(()=>[a(i(I()),1)]),_:1},8,["class"])):p("",!0)]),_:1}),o(q,{flat:"",class:"bg-accent",style:{"border-radius":"10px"},rounded:""},{default:l(()=>[s("div",it,[R.value!=null?(r(),d("img",{key:0,src:R.value,class:"user-avatar"},null,8,nt)):(r(),d("img",{key:1,src:_(_e),class:"user-avatar"},null,8,lt)),s("div",dt,[s("p",pt,i(m.value?.firstname)+" "+i(m.value?.lastname),1),o(C,{rounded:"",color:"primary",style:{"font-size":"smaller","font-weight":"600",opacity:"75%","justify-content":"center","padding-top":"5px"}},{default:l(()=>[a(i(H[m.value?.role||"withoutRole"]),1)]),_:1})])]),o(P,{"transition-show":"jump-down","transition-hide":"jump-up","transition-duration":"300",fit:"",offset:[0,5]},{default:l(()=>[o(S,{class:"bg-secondary"},{default:l(()=>[j((r(),f(y,{clickable:"",to:{name:"profile"}},{default:l(()=>[o(g,{class:"no-select"},{default:l(()=>e[39]||(e[39]=[a("Профиль")])),_:1})]),_:1})),[[b]]),o($),m.value?.role==="teacher"||m.value?.role==="student"?j((r(),f(y,{key:0,clickable:"",to:{name:"i-member"}},{default:l(()=>[o(g,{class:"no-select"},{default:l(()=>e[40]||(e[40]=[a("Моя команда")])),_:1})]),_:1})),[[b]]):p("",!0),j((r(),f(y,{clickable:"",to:{name:"my-projects",query:{tab:"published"}}},{default:l(()=>[o(g,{class:"no-select"},{default:l(()=>e[41]||(e[41]=[a("Мои проекты")])),_:1})]),_:1})),[[b]]),j((r(),f(y,{clickable:"",to:{name:"my-requests"}},{default:l(()=>[o(g,{class:"no-select"},{default:l(()=>e[42]||(e[42]=[a("Мои заявки")])),_:1})]),_:1})),[[b]]),m.value?.role==="teacher"?j((r(),f(y,{key:1,clickable:"",to:{name:"requests-moderation",query:{tab:"teams"}}},{default:l(()=>[o(g,{class:"no-select"},{default:l(()=>e[43]||(e[43]=[a("Модерация заявок")])),_:1})]),_:1})),[[b]]):p("",!0),o($),j((r(),f(y,{clickable:"",onClick:O,class:"logout"},{default:l(()=>[o(g,{class:"no-select"},{default:l(()=>e[44]||(e[44]=[a("Выйти")])),_:1}),o(g,{avatar:""},{default:l(()=>[s("img",{src:_(ve),height:"20px",width:"auto"},null,8,ct)]),_:1})]),_:1})),[[b]])]),_:1})]),_:1})]),_:1})])]))}}),mt=ye(ut,[["__scopeId","data-v-9a3c2088"]]),_t={class:"content"},Ut=M({__name:"HomePage",setup(J){return(w,v)=>{const T=ue("router-view");return r(),d(N,null,[o(mt,{class:"header"}),s("div",_t,[o(T)])],64)}}});export{Ut as default};
