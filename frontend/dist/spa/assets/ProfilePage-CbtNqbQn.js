import{Q as v}from"./QInput-CNi2zBEZ.js";import{Q as C}from"./QCheckbox-cCcz-w8e.js";import{Q as A}from"./QBtn-nCgHYuWN.js";import{d as q,r as i,u as G,m as J,b as d,e as l,i as c,p as h,t as P,f as r,h as U,F as S,g as M,w as f,T as y,o as u,l as K}from"./index-Mo4dBhOw.js";import{A as D}from"./auth.service-BOxIUbgp.js";import{a as W}from"./avatar_alt-Cq5VdRAy.js";import{l as Q,f as R,d as $,a as N}from"./technologies-DZ1Ymkc2.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vm-qSUGPvtL.js";import"./render-DXJ7UJne.js";import"./uid-Bzmka5Fh.js";import"./use-dark-mFa0dIct.js";import"./focus-manager-zjdVGI5d.js";const Z={class:"profile-component"},ee={class:"card"},ae={class:"card-top"},te={class:"avatar"},le=["src"],oe={style:{"background-color":"#41789C","margin-top":"5px",padding:"5px","border-radius":"10px",color:"aliceblue","font-family":"system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif","font-size":"medium"}},se={class:"main-data"},ne={style:{"padding-left":"5px",opacity:"0.7"}},ue={class:"card-bottom"},ie={key:0,class:"stack-container"},re={class:"technologies"},de={class:"stack-list"},me={class:"stack-list"},ce={class:"stack-list"},pe={class:"stack-list"},ve={class:"actions"},fe={key:"edit",class:"edit-button-container"},ye={key:"save-cancel",class:"save-cancel-buttons-container"},ge=q({__name:"ProfilePage",setup(be){const p=i(null),H=G(),E=i(null),B=i(null),g=i(""),b=i(""),V=i(""),k=i(""),x=i(""),F=i(""),_=i(""),I=i(""),w=i(""),n=i(!1),o=i({}),L={parther:"Партнер",student:"Студент",teacher:"Преподаватель",withoutRole:"Без роли"},m=i(null);J(async()=>{const t=await D.getProfile();if(t){p.value=t,m.value={...t},g.value=t.mail,b.value=t.firstname,V.value=t.lastname,k.value=t.group,x.value=t.phone,F.value=t.createAt,_.value=t.aboutMe||"",w.value=t.role,console.log(t.competencies),Q.forEach(s=>o.value[s]=!1),R.forEach(s=>o.value[s]=!1),$.forEach(s=>o.value[s]=!1),N.forEach(s=>o.value[s]=!1),t.competencies&&t.competencies.forEach(s=>{o.value[s]=!0});const e=new Date(F.value),a=s=>s.toString().padStart(2,"0");I.value=`${a(e.getDate())}.${a(e.getMonth()+1)}.${e.getFullYear()}, ${a(e.getHours())}:${a(e.getMinutes())}`,await O(t.id)}});const O=async t=>{try{const e=await D.getAvatar(t);e&&e.size>0&&(B.value=URL.createObjectURL(e))}catch(e){console.error("Ошибка загрузки аватара:",e)}},j=async t=>{const e=t.target;if(e.files&&e.files[0])try{const a=new FormData;a.append("avatar",e.files[0]),await D.uploadAvatar(a),p.value&&await O(p.value.id),window.location.reload()}catch(a){console.error("Ошибка загрузки аватара:",a)}},z=()=>{n.value=!0},T=async()=>{if(p.value){const t={...p.value,mail:g.value,firstname:b.value,lastname:V.value,group:k.value,phone:x.value,aboutMe:_.value,competencies:Object.keys(o.value).filter(a=>o.value[a])},e=await D.updateProfile(t);e&&(p.value=e,m.value={...e},H.updateUser({mail:e.mail,firstname:e.firstname,lastname:e.lastname,group:e.group,phone:e.phone,aboutMe:e.aboutMe,competencies:e.competencies}),K.success("Изменения сохранены"),n.value=!1)}},Y=()=>{m.value&&(g.value=m.value.mail,b.value=m.value.firstname,V.value=m.value.lastname,k.value=m.value.group,x.value=m.value.phone,_.value=m.value.aboutMe||""),n.value=!1};return(t,e)=>(u(),d("div",Z,[l("div",ee,[e[13]||(e[13]=l("h3",{style:{"text-align":"center","font-family":"system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif",color:"rgba(80, 147, 192, 1)","font-weight":"500"}},"Профиль",-1)),l("div",ae,[l("div",te,[l("input",{type:"file",ref_key:"fileInput",ref:E,accept:"image/*",onChange:j,style:{display:"none"}},null,544),l("img",{src:B.value||h(W),class:"user-avatarr",onClick:e[0]||(e[0]=a=>E.value?.click())},null,8,le),l("p",oe,P(L[w.value||"withoutRole"]),1)]),l("div",se,[r(v,{standout:"bg-primary text-white",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),label:"Почта",type:"email",style:{"margin-top":"20px","margin-bottom":"20px"},readonly:""},null,8,["modelValue"]),r(v,{standout:"bg-primary text-white",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),label:"Имя",type:"text",style:{"margin-top":"20px","margin-bottom":"20px"},readonly:!n.value},null,8,["modelValue","readonly"]),r(v,{standout:"bg-primary text-white",modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value=a),label:"Фамилия",type:"text",style:{"margin-top":"20px","margin-bottom":"20px"},readonly:!n.value},null,8,["modelValue","readonly"]),w.value==="student"?(u(),U(v,{key:0,standout:"bg-primary text-white",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=a=>k.value=a),label:"Группа",type:"text",style:{"margin-top":"20px","margin-bottom":"20px"},readonly:!n.value},null,8,["modelValue","readonly"])):c("",!0),r(v,{standout:"bg-primary text-white",modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=a=>x.value=a),label:"Телефон",type:"tel",style:{"margin-top":"20px","margin-bottom":"20px"},readonly:!n.value},null,8,["modelValue","readonly"]),l("p",ne,"Дата регистрации: "+P(I.value),1)])]),l("div",ue,[r(v,{outlined:"",modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=a=>_.value=a),type:"textarea",label:"Обо мне",autogrow:"",readonly:!n.value},null,8,["modelValue","readonly"])]),w.value==="student"?(u(),d("div",ie,[e[11]||(e[11]=l("p",{class:"stack-title"},"Стек технологий",-1)),e[12]||(e[12]=l("p",{class:"post-text"},'*нажмите "изменить", чтобы увидеть больше',-1)),l("div",re,[l("div",de,[e[7]||(e[7]=l("p",{class:"stack-category"},"ЯП",-1)),(u(!0),d(S,null,M(h(Q),a=>(u(),d("div",{key:a},[r(y,{mode:"out-in",name:"fade-edit"},{default:f(()=>[n.value||o.value[a]===!0?(u(),U(C,{key:0,modelValue:o.value[a],"onUpdate:modelValue":s=>o.value[a]=s,label:a,disable:!n.value},null,8,["modelValue","onUpdate:modelValue","label","disable"])):c("",!0)]),_:2},1024)]))),128))]),l("div",me,[e[8]||(e[8]=l("p",{class:"stack-category"},"Фреймворки",-1)),(u(!0),d(S,null,M(h(R),a=>(u(),d("div",{key:a},[r(y,{mode:"out-in",name:"fade-edit"},{default:f(()=>[n.value||o.value[a]===!0?(u(),U(C,{key:0,modelValue:o.value[a],"onUpdate:modelValue":s=>o.value[a]=s,label:a,disable:!n.value},null,8,["modelValue","onUpdate:modelValue","label","disable"])):c("",!0)]),_:2},1024)]))),128))]),l("div",ce,[e[9]||(e[9]=l("p",{class:"stack-category"},"Базы данных",-1)),(u(!0),d(S,null,M(h($),a=>(u(),d("div",{key:a},[r(y,{mode:"out-in",name:"fade-edit"},{default:f(()=>[n.value||o.value[a]===!0?(u(),U(C,{key:0,modelValue:o.value[a],"onUpdate:modelValue":s=>o.value[a]=s,label:a,disable:!n.value},null,8,["modelValue","onUpdate:modelValue","label","disable"])):c("",!0)]),_:2},1024)]))),128))]),l("div",pe,[e[10]||(e[10]=l("p",{class:"stack-category"},"DevOps",-1)),(u(!0),d(S,null,M(h(N),a=>(u(),d("div",{key:a},[r(y,{mode:"out-in",name:"fade-edit"},{default:f(()=>[n.value||o.value[a]===!0?(u(),U(C,{key:0,modelValue:o.value[a],"onUpdate:modelValue":s=>o.value[a]=s,label:a,disable:!n.value},null,8,["modelValue","onUpdate:modelValue","label","disable"])):c("",!0)]),_:2},1024)]))),128))])])])):c("",!0),l("div",ve,[r(y,{name:"fade-edit",mode:"out-in"},{default:f(()=>[n.value?c("",!0):(u(),d("div",fe,[r(A,{color:"primary",label:"Изменить",onClick:z,class:"action-button"})]))]),_:1}),r(y,{name:"fade-save-cancel",mode:"out-in"},{default:f(()=>[n.value?(u(),d("div",ye,[r(A,{color:"primary",label:"Сохранить",onClick:T,class:"action-button"}),r(A,{outline:"",color:"primary",label:"Отмена",onClick:Y,class:"action-button"})])):c("",!0)]),_:1})])])]))}}),Be=X(ge,[["__scopeId","data-v-c033867a"]]);export{Be as default};
