import{Q as d}from"./QBtn-nCgHYuWN.js";import{Q as p}from"./QCardSection-Ct4B8z0C.js";import{Q as S}from"./QInput-CNi2zBEZ.js";import{Q as $}from"./QCard-Dri9TERK.js";import{Q as V}from"./QDialog-C0WFBzRC.js";import{Q as O}from"./QSeparator-DCXVSXi9.js";import{Q as ce}from"./QBadge-l-h_4b-W.js";import{C as j}from"./ClosePopup-BbmzLGBu.js";import{a as I}from"./avatar_alt-Cq5VdRAy.js";import{d as ue,u as pe,r as k,a6 as me,k as fe,H as ve,m as ye,z as y,Q as ge,b as u,e as o,f as a,t as i,w as r,F as R,g as L,q as xe,I as be,o as c,x as D,i as q,p as x,v as b,h as he,a as _e,l as v}from"./index-Mo4dBhOw.js";import{r as we,d as ke,a as Ce}from"./interpritation.service-_3ecFNJG.js";import{A as Te}from"./auth.service-BOxIUbgp.js";import{T as $e}from"./team.service-B4CHocZN.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vm-qSUGPvtL.js";import"./render-DXJ7UJne.js";import"./uid-Bzmka5Fh.js";import"./use-dark-mFa0dIct.js";import"./focus-manager-zjdVGI5d.js";import"./use-timeout-HZbuKFz0.js";import"./focusout-BuI3YoVi.js";const je={class:"teams-header"},De={class:"i-member-teams-title"},Me={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},Ue={style:{display:"flex","justify-content":"center"}},Se=["id"],Re={class:"teams-header",style:{"align-items":"center"}},Le={class:"team-title"},Qe={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},Pe={class:"text-h5",style:{color:"#41789C"}},Be={style:{display:"flex","justify-content":"space-around","align-items":"center","flex-direction":"row","margin-top":"15px"}},Ie=["src"],ze={key:1,class:"user-avatar",style:{"margin-left":"40px",height:"80px",border:"2px solid #41789C"},src:I},Ae={style:{display:"flex","flex-direction":"column",width:"100%","align-items":"center"}},Ne={class:"team-title-panel",style:{"flex-direction":"column","align-items":"center"}},Oe={class:"team-description"},qe={class:"team-description",style:{"text-decoration":"underline"}},Ee={class:"team-title-panel"},Fe={class:"team-description"},He={key:0,class:"team-title-panel"},We={class:"team-description"},Ge={style:{display:"flex","flex-direction":"row","justify-content":"space-around","margin-top":"20px"}},Je=["onClick"],Ke={class:"team-info"},Xe={class:"team-title-panel",style:{"flex-direction":"column",width:"100%"}},Ye={class:"team-description"},Ze={class:"team-title-panel about-team",style:{"flex-direction":"column"}},et={class:"team-description"},tt={class:"team-description"},lt={class:"team-description"},st={class:"team-description"},ot={class:"team-description"},at={class:"team-title-panel",style:{"max-width":"100%"}},it={key:0,class:"stack-panel"},rt={style:{margin:"0"}},nt={key:1},dt={class:"memberList"},ct={class:"team-title-panel members-panel"},ut=["src"],pt={key:1,class:"user-avatar",src:I},mt={class:"member-info"},ft={class:"team-description",style:{"text-align":"center"}},vt={class:"team-description",style:{"text-align":"center","font-size":"14px","text-decoration":"underline"}},yt=["src"],gt={key:1,class:"user-avatar",src:I},xt={class:"member-info"},bt={class:"team-description",style:{"text-align":"center"}},ht={class:"team-description",style:{"text-align":"center","font-size":"14px","text-decoration":"underline"}},_t={style:{display:"flex","justify-content":"space-between","flex-direction":"row"}},wt={class:"text-h6",style:{color:"#41789C","margin-left":"30px"}},kt={style:{display:"flex","justify-content":"space-between","flex-direction":"row"}},Ct={class:"teamControlButtons"},Tt={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},$t={style:{display:"flex","justify-content":"center"}},Vt={style:{display:"flex","justify-content":"space-between","flex-direction":"row"}},jt={class:"text-h6",style:{color:"#41789C","margin-left":"30px"}},Dt={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},Mt=ue({__name:"LeaderTeamList",props:{isTeamDeleteDialogOpen:{type:Boolean}},emits:["update:isTeamDeleteDialogOpen"],setup(E,{emit:F}){const H=_e(),Q=xe(),C=pe().getUser,m=k([]),M=k({}),T=k({}),h=k({}),g=k([]),P=k([]),U=k(!1),n=me({deletingTeams:{},deletingMembers:{},showingRequests:{},editingTeams:{}}),W=(l,e)=>n.deletingMembers[l]?.[e]??!1,G=(l,e,t)=>{n.deletingMembers[l]||(n.deletingMembers[l]={}),n.deletingMembers[l][e]=t},J=l=>{n.deletingTeams[l]=!0},K=(l,e)=>{n.deletingMembers[l]||(n.deletingMembers[l]={}),n.deletingMembers[l][e]=!0},z=(l,e)=>{n.deletingMembers[l]&&(n.deletingMembers[l][e]=!1)},_=k(""),w=k(""),A=()=>{_.value="",w.value=""},X=async(l,e)=>{try{const t=e.map(f=>y.get(`user/${f}`)),s=await Promise.all(t);T.value[l]=s.map(f=>f.data),await Promise.all(s.map(f=>B(f.data.id)))}catch(t){console.error("Ошибка загрузки данных участников:",t)}},B=async l=>{try{const e=await Te.getAvatar(l);if(e&&e.size>0){const t=URL.createObjectURL(e);h.value={...h.value,[l]:t}}}catch(e){console.error(`Ошибка загрузки аватара пользователя ${l}:`,e)}},Y=async(l,e)=>{try{await B(e),T.value[l]?.push((await y.get(`user/${e}`)).data)}catch(t){console.log(t.message)}},Z=async()=>{try{await y.post("create-team-request",{title:_.value,description:w.value}),v.success("Заявка отправлена"),U.value=!1,de.value=!1}catch(l){v.error(l.message)}},ee=async(l,e)=>{try{await y.patch(`team-request/${l}`,{status:"rejected"}),g.value=g.value.filter(t=>t.id!=l),g.value.filter(t=>t.teamId===e).length===0&&(n.showingRequests[e]=!1),v.success("Заявка отклонена")}catch(t){v.error(t.message)}},te=async(l,e,t)=>{try{await y.patch(`team-request/${l}`,{status:"approved"}),g.value=g.value.filter(s=>s.id!=l),await Y(e,t),g.value.filter(s=>s.teamId===e).length===0&&(n.showingRequests[e]=!1),v.success("Заявка одобрена")}catch(s){v.error(s.message)}},le=async(l,e)=>{try{if(e=="close"){await y.patch(`teams/open/${l}`),v.success("Команда открыта");const t=m.value.findIndex(s=>s.id===l);t!==-1&&(m.value[t].status="open")}else if(e=="open"){await y.patch(`teams/close/${l}`),v.success("Команда закрыта");const t=m.value.findIndex(s=>s.id===l);t!==-1&&(m.value[t].status="close")}}catch(t){v.error(t.message)}},se=async(l,e)=>{try{await y.delete(`teams/${l}/members/${e}`),z(Number(l),e),T.value[l]=T.value[l].filter(t=>t.id!=Number(e)),v.success("участник исключен")}catch(t){v.error(t.message)}},oe=(l,e,t)=>{n.editingTeams[t]=!0,_.value=l,w.value=e},ae=async l=>{try{await y.patch(`teams/${l}`,{title:_.value,description:w.value}),v.success("Информация о команде изменена");const e=m.value.findIndex(t=>t.id===l);e!==-1&&(m.value[e].title=_.value,m.value[e].description=w.value),n.editingTeams[l]=!1}catch(e){v.error(e.message)}},ie=async l=>{try{await y.delete(`teams/${l}`),m.value=m.value.filter(e=>e.id!=Number(l))}catch(e){v.error(e.message)}},re=E,ne=F,de=fe({get:()=>re.isTeamDeleteDialogOpen,set:l=>ne("update:isTeamDeleteDialogOpen",l)}),N=async()=>{Q.hash&&await be(()=>{const l=document.querySelector(Q.hash);l&&setTimeout(()=>{l.scrollIntoView({behavior:"smooth",block:"center"}),l.classList.add("highlight"),setTimeout(()=>{l.classList.remove("highlight")},2e3)},300)})};return ve(()=>Q.hash,async()=>{await N()}),ye(async()=>{m.value=(await y.get("teams")).data,g.value=(await y.get("team-request/leader")).data,await Promise.all(m.value.map(async l=>{M.value[l.id]=await $e.loadStack(l.id),l.currentProjectId&&P.value.push((await y.get(`project/${l.currentProjectId}`)).data)})),g.value.forEach(l=>{B(l.userId).catch(e=>console.error("Error loading request avatars:",e))}),m.value.forEach(l=>{X(l.id,l.members).catch(e=>console.error("Error loading members:",e))}),await N()}),ge(()=>{Object.entries(h.value).forEach(([l])=>{l&&typeof l=="string"&&URL.revokeObjectURL(l)})}),(l,e)=>(c(),u("div",null,[o("div",je,[o("p",De,"Команд: "+i(m.value.length),1),a(d,{outline:"",color:"primary",label:"создать команду",style:{height:"20px","border-radius":"10px"},icon:"add",onClick:e[0]||(e[0]=t=>U.value=!0)})]),a(V,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=t=>U.value=t),"backdrop-filter":"blur(4px)","transition-show":"fade","transition-hide":"fade",onBeforeHide:e[5]||(e[5]=t=>A())},{default:r(()=>[a($,{flat:"",bordered:"",class:"team-edit-card",style:{"border-radius":"15px"}},{default:r(()=>[a(p,null,{default:r(()=>[o("div",Me,[e[9]||(e[9]=o("p",{class:"text-h5",style:{color:"#41789C"}},"Создание команды",-1)),D(a(d,{flat:"",color:"primary",rounded:"",icon:"close"},null,512),[[j]])])]),_:1}),a(p,null,{default:r(()=>[a(S,{outlined:"",label:"Название команды",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),type:"text"},null,8,["modelValue"])]),_:1}),a(p,null,{default:r(()=>[a(S,{outlined:"",label:"Описание команды",modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),a(p,null,{default:r(()=>[o("div",Ue,[a(d,{filled:"",color:"primary",label:"подать заявку",onClick:e[3]||(e[3]=t=>Z()),style:{"border-radius":"10px"}})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(c(!0),u(R,null,L(m.value,t=>(c(),u("div",{key:t.id,id:`team-${t.id}`},[a(O),o("div",Re,[o("p",Le,i(t.title),1),a(d,{outline:"",color:"primary",label:g.value.filter(s=>s.teamId===t.id).length+" "+x(we)(g.value.filter(s=>s.teamId===t.id).length)+" в команду",style:{height:"20px","border-radius":"10px","min-width":"200px"},onClick:s=>n.showingRequests[t.id]=!0,disable:g.value.filter(s=>s.teamId===t.id).length==0},null,8,["label","onClick","disable"]),a(V,{"model-value":n.showingRequests[t.id]??!1,"onUpdate:modelValue":s=>n.showingRequests[t.id]=s,"backdrop-filter":"blur(4px)","transition-show":"fade","transition-hide":"fade"},{default:r(()=>[a($,{flat:"",bordered:"",class:"team-edit-card",style:{"border-radius":"15px"}},{default:r(()=>[a(p,null,{default:r(()=>[o("div",Qe,[o("p",Pe,[e[10]||(e[10]=b("Заявки на вступление в команду ")),o("strong",null,i(t.title),1)]),D(a(d,{flat:"",color:"primary",rounded:"",icon:"close",style:{"max-height":"48px"}},null,512),[[j]])])]),_:2},1024),(c(!0),u(R,null,L(g.value.filter(s=>s.teamId===t.id),s=>(c(),he(p,{key:s.id},{default:r(()=>[a(O),o("div",Be,[h.value[s.userId]?(c(),u("img",{key:0,class:"user-avatar",style:{"margin-left":"40px",height:"80px",border:"2px solid #41789C"},src:h.value[s.userId]??""},null,8,Ie)):(c(),u("img",ze)),o("div",Ae,[o("div",Ne,[o("p",Oe,i(s.user.firstname)+" "+i(s.user.lastname),1),o("p",qe,i(s.user.mail),1)]),o("div",Ee,[o("p",Fe,[e[11]||(e[11]=o("strong",null,"Группа:",-1)),b(" "+i(s.user.group),1)])]),s.user.aboutMe?(c(),u("div",He,[o("p",We,i(s.user.aboutMe),1)])):q("",!0)])]),o("div",Ge,[a(d,{filled:"",color:"primary",label:"Принять",icon:"check_circle",onClick:f=>te(s.id,t.id,s.userId),style:{"border-radius":"10px"}},null,8,["onClick"]),a(d,{outline:"",color:"primary",label:"Отклонить",icon:"cancel",onClick:f=>ee(s.id,t.id),style:{"border-radius":"10px"}},null,8,["onClick"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue"])]),t.currentProjectId?(c(),u("p",{key:0,class:"working-team",onClick:s=>x(H).push({name:"projects",params:{projectId:t.currentProjectId,rialtoId:P.value.find(f=>f.id===t.currentProjectId)?.rialtoId}})},[o("strong",null,"Занимается проектом: "+i(P.value.find(s=>s.id===t.currentProjectId)?.title),1)],8,Je)):q("",!0),o("div",Ke,[o("div",Xe,[e[12]||(e[12]=o("p",{class:"team-description"},[o("strong",null,"Описание:")],-1)),o("p",Ye,i(t.description),1)]),o("div",Ze,[o("p",et,[e[13]||(e[13]=o("strong",null,"Тим-лидер:",-1)),b(" "+i(x(C)?.firstname)+" "+i(x(C)?.lastname),1)]),o("p",tt,[e[14]||(e[14]=o("strong",null,"Дата создания:",-1)),b(" "+i(x(ke)(t.createdAt)),1)]),o("p",lt,[e[15]||(e[15]=o("strong",null,"Статус:",-1)),b(" "+i(t.currentProjectId?"В работе":"В поисках"),1)]),o("p",st,[e[16]||(e[16]=o("strong",null,"Приватность:",-1)),b(" "+i(x(Ce)[t.status]),1)]),a(d,{color:"primary",unelevated:"",size:"xs",label:t.status=="close"?"Открыть":"Закрыть",style:{"font-size":"10px","border-radius":"10px"},onClick:s=>le(t.id,t.status)},null,8,["label","onClick"]),o("p",ot,[e[17]||(e[17]=o("strong",null,"Количество участников:",-1)),b(" "+i(t.members.length+1),1)])])]),o("div",at,[M.value[t.id]&&M.value[t.id].length>0?(c(),u("div",it,[e[18]||(e[18]=o("p",{class:"team-description",style:{"align-self":"center"}},[o("strong",null,"Стек технологий: ")],-1)),(c(!0),u(R,null,L(M.value[t.id],s=>(c(),u("div",{class:"stack-card",key:s},[o("p",rt,i(s),1)]))),128))])):(c(),u("div",nt,e[19]||(e[19]=[o("p",{class:"team-description",style:{"align-self":"center"}},[o("strong",null,"Стек отсутствует")],-1)])))]),o("div",dt,[o("div",ct,[x(C)?.id&&h.value[x(C).id??""]?(c(),u("img",{key:0,class:"user-avatar",src:h.value[x(C)?.id??""]??""},null,8,ut)):(c(),u("img",pt)),o("div",mt,[a(ce,{color:"accent",style:{"align-self":"center","margin-bottom":"10px"},class:"leader-badge"},{default:r(()=>e[20]||(e[20]=[b("Тим-лидер")])),_:1}),o("p",ft,i(x(C)?.firstname)+" "+i(x(C)?.lastname),1),o("p",vt,i(x(C)?.mail),1)])]),(c(!0),u(R,null,L(T.value[t.id],s=>(c(),u("div",{class:"team-title-panel members-panel",key:s.id},[h.value[s.id]?(c(),u("img",{key:0,class:"user-avatar",src:h.value[s.id]??""},null,8,yt)):(c(),u("img",gt)),o("div",xt,[o("p",bt,i(s.firstname)+" "+i(s.lastname),1),o("p",ht,i(s.mail),1),a(d,{filled:"",color:"primary",label:"исключить",size:"10px",style:{"border-radius":"10px","margin-top":"5px"},onClick:f=>K(t.id,s.id.toString())},null,8,["onClick"]),a(V,{"model-value":W(t.id,s.id.toString()),"onUpdate:modelValue":f=>G(t.id,s.id.toString(),f),"backdrop-filter":"blur(4px)","transition-show":"fade","transition-hide":"fade"},{default:r(()=>[a($,{flat:"",bordered:"",class:"team-edit-card",style:{"border-radius":"15px"}},{default:r(()=>[a(p,null,{default:r(()=>[o("div",_t,[e[21]||(e[21]=o("p",{class:"text-h5",style:{color:"#41789C"}},"Исключение участника",-1)),D(a(d,{flat:"",color:"primary",rounded:"",icon:"close"},null,512),[[j]])])]),_:1}),a(p,null,{default:r(()=>[o("p",wt,[e[22]||(e[22]=b("Вы уверены, что хотите ")),e[23]||(e[23]=o("span",{style:{color:"#eb6449"}},"исключить",-1)),b(" участника "+i(s.firstname)+" "+i(s.lastname)+' из команды "'+i(t.title)+'"?',1)])]),_:2},1024),a(p,null,{default:r(()=>[o("div",kt,[a(d,{outline:"",color:"negative",style:{"border-radius":"10px","margin-left":"20px"},label:"Да, исключить",onClick:f=>se(t.id.toString(),s.id.toString())},null,8,["onClick"]),a(d,{filled:"",color:"primary",style:{"border-radius":"10px","margin-right":"20px"},label:"Нет, не исключать",onClick:f=>z(t.id,s.id.toString())},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue"])])]))),128))]),o("div",Ct,[a(d,{outline:"",color:"primary",label:"изменить",style:{"margin-right":"10px","border-radius":"10px","margin-bottom":"20px"},icon:"edit",onClick:s=>oe(t.title,t.description,t.id)},null,8,["onClick"]),a(V,{"model-value":n.editingTeams[t.id]??!1,"onUpdate:modelValue":s=>n.editingTeams[t.id]=s,"backdrop-filter":"blur(4px)","transition-show":"fade","transition-hide":"fade",onBeforeHide:e[8]||(e[8]=s=>A())},{default:r(()=>[a($,{flat:"",bordered:"",class:"team-edit-card",style:{"border-radius":"15px"}},{default:r(()=>[a(p,null,{default:r(()=>[o("div",Tt,[e[24]||(e[24]=o("div",{class:"text-h5",style:{color:"#41789C"}},"Изменение команды",-1)),D(a(d,{flat:"",color:"primary",rounded:"",icon:"close"},null,512),[[j]])])]),_:1}),a(p,null,{default:r(()=>[a(S,{outlined:"",label:"Название команды",modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=s=>_.value=s),type:"text"},null,8,["modelValue"])]),_:1}),a(p,null,{default:r(()=>[a(S,{outlined:"",label:"Описание команды",modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=s=>w.value=s),type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),a(p,null,{default:r(()=>[o("div",$t,[a(d,{filled:"",label:"сохранить изменения",color:"primary",onClick:s=>ae(t.id),style:{"border-radius":"10px"}},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue"]),a(d,{filled:"",color:"primary",label:"удалить",style:{"border-radius":"10px","margin-bottom":"20px"},"icon-right":"delete_forever",onClick:s=>J(t.id)},null,8,["onClick"]),a(V,{"model-value":n.deletingTeams[t.id]??!1,"onUpdate:modelValue":s=>n.deletingTeams[t.id]=s,"backdrop-filter":"blur(4px)","transition-show":"fade","transition-hide":"fade"},{default:r(()=>[a($,{flat:"",bordered:"",class:"team-edit-card",style:{"border-radius":"15px"}},{default:r(()=>[a(p,null,{default:r(()=>[o("div",Vt,[e[25]||(e[25]=o("p",{class:"text-h5",style:{color:"#41789C"}},"Удаление команды",-1)),D(a(d,{flat:"",color:"primary",rounded:"",icon:"close"},null,512),[[j]])])]),_:1}),a(p,null,{default:r(()=>[o("p",jt,[e[26]||(e[26]=b("Вы уверены, что хотите ")),e[27]||(e[27]=o("span",{style:{color:"#eb6449"}},"удалить",-1)),b(' команду "'+i(t.title)+'"?',1)])]),_:2},1024),a(p,null,{default:r(()=>[o("div",Dt,[a(d,{outline:"",color:"negative",style:{"border-radius":"10px","margin-left":"20px"},label:"Да, удалить",onClick:s=>ie(t.id.toString())},null,8,["onClick"]),a(d,{filled:"",color:"primary",style:{"border-radius":"10px","margin-right":"20px"},label:"Нет, не удалять",onClick:s=>n.deletingTeams[t.id]=!1},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue"])])],8,Se))),128))]))}}),Yt=Ve(Mt,[["__scopeId","data-v-dbb938f6"]]);export{Yt as default};
